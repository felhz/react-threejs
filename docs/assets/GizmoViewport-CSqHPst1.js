import{s as y,W as Q,i as H,H as X,x as Y,y as B,d as S,_ as C,z as V,E as Z,c as P,G as J,Q as O,p as K,J as N}from"./OrbitControls-BaRFn3-G.js";import{r as e}from"./ssg-client-Dg7YBUPF.js";function U(n,d,u){const o=y(l=>l.size),s=y(l=>l.viewport),p=typeof n=="number"?n:o.width*s.dpr,i=o.height*s.dpr,r=(typeof n=="number"?u:n)||{},{samples:c=0,depth:g,...f}=r,m=e.useMemo(()=>{const l=new Q(p,i,{minFilter:H,magFilter:H,type:X,...f});return g&&(l.depthTexture=new Y(p,i,B)),l.samples=c,l},[]);return e.useLayoutEffect(()=>{m.setSize(p,i),c&&(m.samples=c)},[c,m,p,i]),e.useEffect(()=>()=>m.dispose(),[]),m}const $=n=>typeof n=="function",ee=e.forwardRef(({envMap:n,resolution:d=256,frames:u=1/0,children:o,makeDefault:s,...p},i)=>{const r=y(({set:t})=>t),c=y(({camera:t})=>t),g=y(({size:t})=>t),f=e.useRef(null);e.useImperativeHandle(i,()=>f.current,[]);const m=e.useRef(null),l=U(d);e.useLayoutEffect(()=>{p.manual||f.current.updateProjectionMatrix()},[g,p]),e.useLayoutEffect(()=>{f.current.updateProjectionMatrix()}),e.useLayoutEffect(()=>{if(s){const t=c;return r(()=>({camera:f.current})),()=>r(()=>({camera:t}))}},[f,s,r]);let h=0,E=null;const a=$(o);return S(t=>{a&&(u===1/0||h<u)&&(m.current.visible=!1,t.gl.setRenderTarget(l),E=t.scene.background,n&&(t.scene.background=n),t.gl.render(t.scene,f.current),t.scene.background=E,t.gl.setRenderTarget(null),m.current.visible=!0,h++)}),e.createElement(e.Fragment,null,e.createElement("orthographicCamera",C({left:g.width/-2,right:g.width/2,top:g.height/2,bottom:g.height/-2,ref:f},p),!a&&o),e.createElement("group",{ref:m},a&&o(l.texture)))});function te({defaultScene:n,defaultCamera:d,renderPriority:u=1}){const{gl:o,scene:s,camera:p}=y();let i;return S(()=>{i=o.autoClear,u===1&&(o.autoClear=!0,o.render(n,d)),o.autoClear=!1,o.clearDepth(),o.render(s,p),o.autoClear=i},u),e.createElement("group",{onPointerOver:()=>null})}function ne({children:n,renderPriority:d=1}){const{scene:u,camera:o}=y(),[s]=e.useState(()=>new V);return e.createElement(e.Fragment,null,Z(e.createElement(e.Fragment,null,n,e.createElement(te,{defaultScene:u,defaultCamera:o,renderPriority:d})),s,{events:{priority:d+1}}))}const W=e.createContext({}),re=()=>e.useContext(W),oe=2*Math.PI,A=new J,I=new K,[v,R]=[new O,new O],G=new P,L=new P,ae=n=>"minPolarAngle"in n,q=n=>"getTarget"in n,ie=({alignment:n="bottom-right",margin:d=[80,80],renderPriority:u=1,onUpdate:o,onTarget:s,children:p})=>{const i=y(x=>x.size),r=y(x=>x.camera),c=y(x=>x.controls),g=y(x=>x.invalidate),f=e.useRef(null),m=e.useRef(null),l=e.useRef(!1),h=e.useRef(0),E=e.useRef(new P(0,0,0)),a=e.useRef(new P(0,0,0));e.useEffect(()=>{a.current.copy(r.up)},[r]);const t=e.useCallback(x=>{l.current=!0,(c||s)&&(E.current=(s==null?void 0:s())||(q(c)?c.getTarget(E.current):c==null?void 0:c.target)),h.current=r.position.distanceTo(G),v.copy(r.quaternion),L.copy(x).multiplyScalar(h.current).add(G),A.lookAt(L),R.copy(A.quaternion),g()},[c,r,s,g]);S((x,T)=>{if(m.current&&f.current){var b;if(l.current)if(v.angleTo(R)<.01)l.current=!1,ae(c)&&r.up.copy(a.current);else{const D=T*oe;v.rotateTowards(R,D),r.position.set(0,0,1).applyQuaternion(v).multiplyScalar(h.current).add(E.current),r.up.set(0,1,0).applyQuaternion(v).normalize(),r.quaternion.copy(v),q(c)&&c.setPosition(r.position.x,r.position.y,r.position.z),o?o():c&&c.update(T),g()}I.copy(r.matrix).invert(),(b=f.current)==null||b.quaternion.setFromRotationMatrix(I)}});const k=e.useMemo(()=>({tweenCamera:t}),[t]),[F,z]=d,_=n.endsWith("-center")?0:n.endsWith("-left")?-i.width/2+F:i.width/2-F,j=n.startsWith("center-")?0:n.startsWith("top-")?i.height/2-z:-i.height/2+z;return e.createElement(ne,{renderPriority:u},e.createElement(W.Provider,{value:k},e.createElement(ee,{makeDefault:!0,ref:m,position:[0,0,200]}),e.createElement("group",{ref:f,position:[_,j,0]},p)))};function M({scale:n=[.8,.05,.05],color:d,rotation:u}){return e.createElement("group",{rotation:u},e.createElement("mesh",{position:[.4,0,0]},e.createElement("boxGeometry",{args:n}),e.createElement("meshBasicMaterial",{color:d,toneMapped:!1})))}function w({onClick:n,font:d,disabled:u,arcStyle:o,label:s,labelColor:p,axisHeadScale:i=1,...r}){const c=y(a=>a.gl),g=e.useMemo(()=>{const a=document.createElement("canvas");a.width=64,a.height=64;const t=a.getContext("2d");return t.beginPath(),t.arc(32,32,16,0,2*Math.PI),t.closePath(),t.fillStyle=o,t.fill(),s&&(t.font=d,t.textAlign="center",t.fillStyle=p,t.fillText(s,32,41)),new N(a)},[o,s,p,d]),[f,m]=e.useState(!1),l=(s?1:.75)*(f?1.2:1)*i,h=a=>{a.stopPropagation(),m(!0)},E=a=>{a.stopPropagation(),m(!1)};return e.createElement("sprite",C({scale:l,onPointerOver:u?void 0:h,onPointerOut:u?void 0:n||E},r),e.createElement("spriteMaterial",{map:g,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:s?1:.75,toneMapped:!1}))}const le=({hideNegativeAxes:n,hideAxisHeads:d,disabled:u,font:o="18px Inter var, Arial, sans-serif",axisColors:s=["#ff2060","#20df80","#2080ff"],axisHeadScale:p=1,axisScale:i,labels:r=["X","Y","Z"],labelColor:c="#000",onClick:g,...f})=>{const[m,l,h]=s,{tweenCamera:E}=re(),a={font:o,disabled:u,labelColor:c,onClick:g,axisHeadScale:p,onPointerDown:u?void 0:t=>{E(t.object.position),t.stopPropagation()}};return e.createElement("group",C({scale:40},f),e.createElement(M,{color:m,rotation:[0,0,0],scale:i}),e.createElement(M,{color:l,rotation:[0,0,Math.PI/2],scale:i}),e.createElement(M,{color:h,rotation:[0,-Math.PI/2,0],scale:i}),!d&&e.createElement(e.Fragment,null,e.createElement(w,C({arcStyle:m,position:[1,0,0],label:r[0]},a)),e.createElement(w,C({arcStyle:l,position:[0,1,0],label:r[1]},a)),e.createElement(w,C({arcStyle:h,position:[0,0,1],label:r[2]},a)),!n&&e.createElement(e.Fragment,null,e.createElement(w,C({arcStyle:m,position:[-1,0,0]},a)),e.createElement(w,C({arcStyle:l,position:[0,-1,0]},a)),e.createElement(w,C({arcStyle:h,position:[0,0,-1]},a)))))};export{ie as G,le as a};
