import{d,Y as C,L as b,Z as R,$ as x,a0 as L,u as F,_ as T,f as v,h as w}from"./OrbitControls-CKMLfF9X.js";import{r as e}from"./ssg-client-CDxgdoC5.js";function S(n,o,c){const t=d(u=>u.size),s=d(u=>u.viewport),a=typeof n=="number"?n:t.width*s.dpr,l=typeof o=="number"?o:t.height*s.dpr,g=(typeof n=="number"?c:n)||{},{samples:p=0,depth:m,...i}=g,f=e.useMemo(()=>{const u=new C(a,l,{minFilter:b,magFilter:b,type:R,...i});return m&&(u.depthTexture=new x(a,l,L)),u.samples=p,u},[]);return e.useLayoutEffect(()=>{f.setSize(a,l),p&&(f.samples=p)},[p,f,a,l]),e.useEffect(()=>()=>f.dispose(),[]),f}const H=n=>typeof n=="function",I=e.forwardRef(({envMap:n,resolution:o=256,frames:c=1/0,children:t,makeDefault:s,...a},l)=>{const g=d(({set:r})=>r),p=d(({camera:r})=>r),m=d(({size:r})=>r),i=e.useRef(null);e.useImperativeHandle(l,()=>i.current,[]);const f=e.useRef(null),u=S(o);e.useLayoutEffect(()=>{a.manual||i.current.updateProjectionMatrix()},[m,a]),e.useLayoutEffect(()=>{i.current.updateProjectionMatrix()}),e.useLayoutEffect(()=>{if(s){const r=p;return g(()=>({camera:i.current})),()=>g(()=>({camera:r}))}},[i,s,g]);let E=0,y=null;const h=H(t);return F(r=>{h&&(c===1/0||E<c)&&(f.current.visible=!1,r.gl.setRenderTarget(u),y=r.scene.background,n&&(r.scene.background=n),r.gl.render(r.scene,i.current),r.scene.background=y,r.gl.setRenderTarget(null),f.current.visible=!0,E++)}),e.createElement(e.Fragment,null,e.createElement("orthographicCamera",T({left:m.width/-2,right:m.width/2,top:m.height/2,bottom:m.height/-2,ref:i},a),!h&&t),e.createElement("group",{ref:f},h&&t(u.texture)))});function _({defaultScene:n,defaultCamera:o,renderPriority:c=1}){const{gl:t,scene:s,camera:a}=d();let l;return F(()=>{l=t.autoClear,c===1&&(t.autoClear=!0,t.render(n,o)),t.autoClear=!1,t.clearDepth(),t.render(s,a),t.autoClear=l},c),e.createElement("group",{onPointerOver:()=>null})}function M({children:n,renderPriority:o=1}){const{scene:c,camera:t}=d(),[s]=e.useState(()=>new v);return e.createElement(e.Fragment,null,w(e.createElement(e.Fragment,null,n,e.createElement(_,{defaultScene:c,defaultCamera:t,renderPriority:o})),s,{events:{priority:o+1}}))}export{M as H,I as O,S as u};
