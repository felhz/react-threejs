import{p as Bt}from"./datadiff_-FU1-d8Ot.js";import{r as K,j as ue,u as zr}from"./ssg-client-BOWAZiKX.js";import{M as Er,I as kt,S as yr,D as Lt,R as Ht,a as Gr,H as Me,F as De,b as Ze,L as Re,T as ze,c as rr,d as Pt,C as ke,e as Zr,O as zt,P as Wr,W as Xr,U as ur,f as Gt,g as Zt,h as gr,i as Wt,j as Xt,B as $t,k as jt,l as mr,m as Yt,n as cr,o as Vt,p as qt,q as kr,r as Kt,V as Ke,N as Jt,u as tr,s as hr,t as Qt,E as en,v as rn,w as tn,x as $r,y as nn,z as an,_ as on,A as Lr,G as sn,J as ln}from"./react-three-fiber.esm-Dwr0ABWv.js";import{O as cn}from"./OrbitControls-BnYU7Pd-.js";import{B as un}from"./shapes-DRwekMNB.js";import{T as hn}from"./Text-D2mg_4Qy.js";var Se=Uint8Array,Le=Uint16Array,_r=Uint32Array,jr=new Se([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Yr=new Se([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dn=new Se([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vr=function(a,t){for(var i=new Le(31),c=0;c<31;++c)i[c]=t+=1<<a[c-1];for(var u=new _r(i[30]),c=1;c<30;++c)for(var d=i[c];d<i[c+1];++d)u[d]=d-i[c]<<5|c;return[i,u]},qr=Vr(jr,2),Kr=qr[0],vn=qr[1];Kr[28]=258,vn[258]=28;var pn=Vr(Yr,0),fn=pn[0],wr=new Le(32768);for(var ee=0;ee<32768;++ee){var Be=(ee&43690)>>>1|(ee&21845)<<1;Be=(Be&52428)>>>2|(Be&13107)<<2,Be=(Be&61680)>>>4|(Be&3855)<<4,wr[ee]=((Be&65280)>>>8|(Be&255)<<8)>>>1}var er=function(a,t,i){for(var c=a.length,u=0,d=new Le(t);u<c;++u)++d[a[u]-1];var h=new Le(t);for(u=0;u<t;++u)h[u]=h[u-1]+d[u-1]<<1;var g;if(i){g=new Le(1<<t);var f=15-t;for(u=0;u<c;++u)if(a[u])for(var y=u<<4|a[u],I=t-a[u],T=h[a[u]-1]++<<I,x=T|(1<<I)-1;T<=x;++T)g[wr[T]>>>f]=y}else for(g=new Le(c),u=0;u<c;++u)a[u]&&(g[u]=wr[h[a[u]-1]++]>>>15-a[u]);return g},ar=new Se(288);for(var ee=0;ee<144;++ee)ar[ee]=8;for(var ee=144;ee<256;++ee)ar[ee]=9;for(var ee=256;ee<280;++ee)ar[ee]=7;for(var ee=280;ee<288;++ee)ar[ee]=8;var Jr=new Se(32);for(var ee=0;ee<32;++ee)Jr[ee]=5;var gn=er(ar,9,1),mn=er(Jr,5,1),pr=function(a){for(var t=a[0],i=1;i<a.length;++i)a[i]>t&&(t=a[i]);return t},xe=function(a,t,i){var c=t/8|0;return(a[c]|a[c+1]<<8)>>(t&7)&i},fr=function(a,t){var i=t/8|0;return(a[i]|a[i+1]<<8|a[i+2]<<16)>>(t&7)},_n=function(a){return(a/8|0)+(a&7&&1)},wn=function(a,t,i){(i==null||i>a.length)&&(i=a.length);var c=new(a instanceof Le?Le:a instanceof _r?_r:Se)(i-t);return c.set(a.subarray(t,i)),c},En=function(a,t,i){var c=a.length;if(!c||i&&!i.l&&c<5)return t||new Se(0);var u=!t||i,d=!i||i.i;i||(i={}),t||(t=new Se(c*3));var h=function($){var Fe=t.length;if($>Fe){var Ae=new Se(Math.max(Fe*2,$));Ae.set(t),t=Ae}},g=i.f||0,f=i.p||0,y=i.b||0,I=i.l,T=i.d,x=i.m,U=i.n,W=c*8;do{if(!I){i.f=g=xe(a,f,1);var re=xe(a,f+1,3);if(f+=3,re)if(re==1)I=gn,T=mn,x=9,U=5;else if(re==2){var se=xe(a,f,31)+257,le=xe(a,f+10,15)+4,z=se+xe(a,f+5,31)+1;f+=14;for(var L=new Se(z),te=new Se(19),S=0;S<le;++S)te[dn[S]]=xe(a,f+S*3,7);f+=le*3;for(var b=pr(te),P=(1<<b)-1,X=er(te,b,1),S=0;S<z;){var H=X[xe(a,f,P)];f+=H&15;var k=H>>>4;if(k<16)L[S++]=k;else{var G=0,F=0;for(k==16?(F=3+xe(a,f,3),f+=2,G=L[S-1]):k==17?(F=3+xe(a,f,7),f+=3):k==18&&(F=11+xe(a,f,127),f+=7);F--;)L[S++]=G}}var ne=L.subarray(0,se),O=L.subarray(se);x=pr(ne),U=pr(O),I=er(ne,x,1),T=er(O,U,1)}else throw"invalid block type";else{var k=_n(f)+4,N=a[k-4]|a[k-3]<<8,he=k+N;if(he>c){if(d)throw"unexpected EOF";break}u&&h(y+N),t.set(a.subarray(k,he),y),i.b=y+=N,i.p=f=he*8;continue}if(f>W){if(d)throw"unexpected EOF";break}}u&&h(y+131072);for(var Ie=(1<<x)-1,He=(1<<U)-1,be=f;;be=f){var G=I[fr(a,f)&Ie],J=G>>>4;if(f+=G&15,f>W){if(d)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if(J<256)t[y++]=J;else if(J==256){be=f,I=null;break}else{var Oe=J-254;if(J>264){var S=J-257,ae=jr[S];Oe=xe(a,f,(1<<ae)-1)+Kr[S],f+=ae}var ve=T[fr(a,f)&He],Te=ve>>>4;if(!ve)throw"invalid distance";f+=ve&15;var O=fn[Te];if(Te>3){var ae=Yr[Te];O+=fr(a,f)&(1<<ae)-1,f+=ae}if(f>W){if(d)throw"unexpected EOF";break}u&&h(y+131072);for(var Xe=y+Oe;y<Xe;y+=4)t[y]=t[y-O],t[y+1]=t[y+1-O],t[y+2]=t[y+2-O],t[y+3]=t[y+3-O];y=Xe}}i.l=I,i.p=be,i.b=y,I&&(g=1,i.m=x,i.d=T,i.n=U)}while(!g);return y==t.length?t:wn(t,0,y)},yn=new Se(0),Sn=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function sr(a,t){return En((Sn(a),a.subarray(2,-4)),t)}var Mn=typeof TextDecoder<"u"&&new TextDecoder,In=0;try{Mn.decode(yn,{stream:!0}),In=1}catch{}const bn=a=>a&&a.isCubeTexture;class xn extends Er{constructor(t,i){var c,u;const d=bn(t),g=((u=d?(c=t.image[0])==null?void 0:c.width:t.image.width)!=null?u:1024)/4,f=Math.floor(Math.log2(g)),y=Math.pow(2,f),I=3*Math.max(y,16*7),T=4*y,x=[d?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/I}`,`#define CUBEUV_TEXEL_HEIGHT ${1/T}`,`#define CUBEUV_MAX_MIP ${f}.0`],U=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,W=x.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(Ht.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,re={map:{value:t},height:{value:(i==null?void 0:i.height)||15},radius:{value:(i==null?void 0:i.radius)||100}},k=new kt(1,16),N=new yr({uniforms:re,fragmentShader:W,vertexShader:U,side:Lt});super(k,N)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}class Tn extends Gr{constructor(t){super(t),this.type=Me}parse(t){const h=function(S,b){switch(S){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(b||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(b||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(b||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(b||""))}},I=`
`,T=function(S,b,P){b=b||1024;let H=S.pos,G=-1,F=0,ne="",O=String.fromCharCode.apply(null,new Uint16Array(S.subarray(H,H+128)));for(;0>(G=O.indexOf(I))&&F<b&&H<S.byteLength;)ne+=O,F+=O.length,H+=128,O+=String.fromCharCode.apply(null,new Uint16Array(S.subarray(H,H+128)));return-1<G?(S.pos+=F+G+1,ne+O.slice(0,G)):!1},x=function(S){const b=/^#\?(\S+)/,P=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,X=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,H=/^\s*FORMAT=(\S+)\s*$/,G=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,F={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let ne,O;for((S.pos>=S.byteLength||!(ne=T(S)))&&h(1,"no header found"),(O=ne.match(b))||h(3,"bad initial token"),F.valid|=1,F.programtype=O[1],F.string+=ne+`
`;ne=T(S),ne!==!1;){if(F.string+=ne+`
`,ne.charAt(0)==="#"){F.comments+=ne+`
`;continue}if((O=ne.match(P))&&(F.gamma=parseFloat(O[1])),(O=ne.match(X))&&(F.exposure=parseFloat(O[1])),(O=ne.match(H))&&(F.valid|=2,F.format=O[1]),(O=ne.match(G))&&(F.valid|=4,F.height=parseInt(O[1],10),F.width=parseInt(O[2],10)),F.valid&2&&F.valid&4)break}return F.valid&2||h(3,"missing format specifier"),F.valid&4||h(3,"missing image size specifier"),F},U=function(S,b,P){const X=b;if(X<8||X>32767||S[0]!==2||S[1]!==2||S[2]&128)return new Uint8Array(S);X!==(S[2]<<8|S[3])&&h(3,"wrong scanline width");const H=new Uint8Array(4*b*P);H.length||h(4,"unable to allocate buffer space");let G=0,F=0;const ne=4*X,O=new Uint8Array(4),Ie=new Uint8Array(ne);let He=P;for(;He>0&&F<S.byteLength;){F+4>S.byteLength&&h(1),O[0]=S[F++],O[1]=S[F++],O[2]=S[F++],O[3]=S[F++],(O[0]!=2||O[1]!=2||(O[2]<<8|O[3])!=X)&&h(3,"bad rgbe scanline format");let be=0,J;for(;be<ne&&F<S.byteLength;){J=S[F++];const ae=J>128;if(ae&&(J-=128),(J===0||be+J>ne)&&h(3,"bad scanline data"),ae){const ve=S[F++];for(let Te=0;Te<J;Te++)Ie[be++]=ve}else Ie.set(S.subarray(F,F+J),be),be+=J,F+=J}const Oe=X;for(let ae=0;ae<Oe;ae++){let ve=0;H[G]=Ie[ae+ve],ve+=X,H[G+1]=Ie[ae+ve],ve+=X,H[G+2]=Ie[ae+ve],ve+=X,H[G+3]=Ie[ae+ve],G+=4}He--}return H},W=function(S,b,P,X){const H=S[b+3],G=Math.pow(2,H-128)/255;P[X+0]=S[b+0]*G,P[X+1]=S[b+1]*G,P[X+2]=S[b+2]*G,P[X+3]=1},re=function(S,b,P,X){const H=S[b+3],G=Math.pow(2,H-128)/255;P[X+0]=Ze.toHalfFloat(Math.min(S[b+0]*G,65504)),P[X+1]=Ze.toHalfFloat(Math.min(S[b+1]*G,65504)),P[X+2]=Ze.toHalfFloat(Math.min(S[b+2]*G,65504)),P[X+3]=Ze.toHalfFloat(1)},k=new Uint8Array(t);k.pos=0;const N=x(k),he=N.width,se=N.height,le=U(k.subarray(k.pos),he,se);let z,L,te;switch(this.type){case De:te=le.length/4;const S=new Float32Array(te*4);for(let P=0;P<te;P++)W(le,P*4,S,P*4);z=S,L=De;break;case Me:te=le.length/4;const b=new Uint16Array(te*4);for(let P=0;P<te;P++)re(le,P*4,b,P*4);z=b,L=Me;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:he,height:se,data:z,header:N.string,gamma:N.gamma,exposure:N.exposure,type:L}}setDataType(t){return this.type=t,this}load(t,i,c,u){function d(h,g){switch(h.type){case De:case Me:"colorSpace"in h?h.colorSpace="srgb-linear":h.encoding=3e3,h.minFilter=Re,h.magFilter=Re,h.generateMipmaps=!1,h.flipY=!0;break}i&&i(h,g)}return super.load(t,d,c,u)}}const Je="colorSpace"in new ze;class Cn extends Gr{constructor(t){super(t),this.type=Me}parse(t){const b=Math.pow(2.7182818,2.2);function P(e,r){for(var n=0,o=0;o<65536;++o)(o==0||e[o>>3]&1<<(o&7))&&(r[n++]=o);for(var s=n-1;n<65536;)r[n++]=0;return s}function X(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const H={l:0,c:0,lc:0};function G(e,r,n,o,s){for(;n<e;)r=r<<8|Nr(o,s),n+=8;n-=e,H.l=r>>n&(1<<e)-1,H.c=r,H.lc=n}const F=new Array(59);function ne(e){for(var r=0;r<=58;++r)F[r]=0;for(var r=0;r<65537;++r)F[e[r]]+=1;for(var n=0,r=58;r>0;--r){var o=n+F[r]>>1;F[r]=n,n=o}for(var r=0;r<65537;++r){var s=e[r];s>0&&(e[r]=s|F[s]++<<6)}}function O(e,r,n,o,s,l,p){for(var v=n,w=0,_=0;s<=l;s++){if(v.value-n.value>o)return!1;G(6,w,_,e,v);var E=H.l;if(w=H.c,_=H.lc,p[s]=E,E==63){if(v.value-n.value>o)throw"Something wrong with hufUnpackEncTable";G(8,w,_,e,v);var m=H.l+6;if(w=H.c,_=H.lc,s+m>l+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)p[s++]=0;s--}else if(E>=59){var m=E-59+2;if(s+m>l+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)p[s++]=0;s--}}ne(p)}function Ie(e){return e&63}function He(e){return e>>6}function be(e,r,n,o){for(;r<=n;r++){var s=He(e[r]),l=Ie(e[r]);if(s>>l)throw"Invalid table entry";if(l>14){var p=o[s>>l-14];if(p.len)throw"Invalid table entry";if(p.lit++,p.p){var v=p.p;p.p=new Array(p.lit);for(var w=0;w<p.lit-1;++w)p.p[w]=v[w]}else p.p=new Array(1);p.p[p.lit-1]=r}else if(l)for(var _=0,w=1<<14-l;w>0;w--){var p=o[(s<<14-l)+_];if(p.len||p.p)throw"Invalid table entry";p.len=l,p.lit=r,_++}}return!0}const J={c:0,lc:0};function Oe(e,r,n,o){e=e<<8|Nr(n,o),r+=8,J.c=e,J.lc=r}const ae={c:0,lc:0};function ve(e,r,n,o,s,l,p,v,w,_){if(e==r){o<8&&(Oe(n,o,s,p),n=J.c,o=J.lc),o-=8;var E=n>>o,E=new Uint8Array([E])[0];if(w.value+E>_)return!1;for(var m=v[w.value-1];E-- >0;)v[w.value++]=m}else if(w.value<_)v[w.value++]=e;else return!1;ae.c=n,ae.lc=o}function Te(e){return e&65535}function Xe(e){var r=Te(e);return r>32767?r-65536:r}const $={a:0,b:0};function Fe(e,r){var n=Xe(e),o=Xe(r),s=o,l=n+(s&1)+(s>>1),p=l,v=l-s;$.a=p,$.b=v}function Ae(e,r){var n=Te(e),o=Te(r),s=n-(o>>1)&65535,l=o+s-32768&65535;$.a=l,$.b=s}function ot(e,r,n,o,s,l,p){for(var v=p<16384,w=n>s?s:n,_=1,E;_<=w;)_<<=1;for(_>>=1,E=_,_>>=1;_>=1;){for(var m=0,oe=m+l*(s-E),C=l*_,R=l*E,A=o*_,D=o*E,j,V,ce,ge;m<=oe;m+=R){for(var q=m,Ce=m+o*(n-E);q<=Ce;q+=D){var Q=q+A,de=q+C,Ue=de+A;v?(Fe(e[q+r],e[de+r]),j=$.a,ce=$.b,Fe(e[Q+r],e[Ue+r]),V=$.a,ge=$.b,Fe(j,V),e[q+r]=$.a,e[Q+r]=$.b,Fe(ce,ge),e[de+r]=$.a,e[Ue+r]=$.b):(Ae(e[q+r],e[de+r]),j=$.a,ce=$.b,Ae(e[Q+r],e[Ue+r]),V=$.a,ge=$.b,Ae(j,V),e[q+r]=$.a,e[Q+r]=$.b,Ae(ce,ge),e[de+r]=$.a,e[Ue+r]=$.b)}if(n&_){var de=q+C;v?Fe(e[q+r],e[de+r]):Ae(e[q+r],e[de+r]),j=$.a,e[de+r]=$.b,e[q+r]=j}}if(s&_)for(var q=m,Ce=m+o*(n-E);q<=Ce;q+=D){var Q=q+A;v?Fe(e[q+r],e[Q+r]):Ae(e[q+r],e[Q+r]),j=$.a,e[Q+r]=$.b,e[q+r]=j}E=_,_>>=1}return m}function st(e,r,n,o,s,l,p,v,w,_){for(var E=0,m=0,oe=v,C=Math.trunc(s.value+(l+7)/8);s.value<C;)for(Oe(E,m,n,s),E=J.c,m=J.lc;m>=14;){var R=E>>m-14&16383,A=r[R];if(A.len)m-=A.len,ve(A.lit,p,E,m,n,o,s,w,_,oe),E=ae.c,m=ae.lc;else{if(!A.p)throw"hufDecode issues";var D;for(D=0;D<A.lit;D++){for(var j=Ie(e[A.p[D]]);m<j&&s.value<C;)Oe(E,m,n,s),E=J.c,m=J.lc;if(m>=j&&He(e[A.p[D]])==(E>>m-j&(1<<j)-1)){m-=j,ve(A.p[D],p,E,m,n,o,s,w,_,oe),E=ae.c,m=ae.lc;break}}if(D==A.lit)throw"hufDecode issues"}}var V=8-l&7;for(E>>=V,m-=V;m>0;){var A=r[E<<14-m&16383];if(A.len)m-=A.len,ve(A.lit,p,E,m,n,o,s,w,_,oe),E=ae.c,m=ae.lc;else throw"hufDecode issues"}return!0}function Rr(e,r,n,o,s,l){var p={value:0},v=n.value,w=me(r,n),_=me(r,n);n.value+=4;var E=me(r,n);if(n.value+=4,w<0||w>=65537||_<0||_>=65537)throw"Something wrong with HUF_ENCSIZE";var m=new Array(65537),oe=new Array(16384);X(oe);var C=o-(n.value-v);if(O(e,r,n,C,w,_,m),E>8*(o-(n.value-v)))throw"Something wrong with hufUncompress";be(m,w,_,oe),st(m,oe,e,r,n,E,_,l,s,p)}function lt(e,r,n){for(var o=0;o<n;++o)r[o]=e[r[o]]}function Fr(e){for(var r=1;r<e.length;r++){var n=e[r-1]+e[r]-128;e[r]=n}}function Ar(e,r){for(var n=0,o=Math.floor((e.length+1)/2),s=0,l=e.length-1;!(s>l||(r[s++]=e[n++],s>l));)r[s++]=e[o++]}function Ur(e){for(var r=e.byteLength,n=new Array,o=0,s=new DataView(e);r>0;){var l=s.getInt8(o++);if(l<0){var p=-l;r-=p+1;for(var v=0;v<p;v++)n.push(s.getUint8(o++))}else{var p=l;r-=2;for(var w=s.getUint8(o++),v=0;v<p+1;v++)n.push(w)}}return n}function ct(e,r,n,o,s,l){var Q=new DataView(l.buffer),p=n[e.idx[0]].width,v=n[e.idx[0]].height,w=3,_=Math.floor(p/8),E=Math.ceil(p/8),m=Math.ceil(v/8),oe=p-(E-1)*8,C=v-(m-1)*8,R={value:0},A=new Array(w),D=new Array(w),j=new Array(w),V=new Array(w),ce=new Array(w);for(let Y=0;Y<w;++Y)ce[Y]=r[e.idx[Y]],A[Y]=Y<1?0:A[Y-1]+E*m,D[Y]=new Float32Array(64),j[Y]=new Uint16Array(64),V[Y]=new Uint16Array(E*64);for(let Y=0;Y<m;++Y){var ge=8;Y==m-1&&(ge=C);var q=8;for(let ie=0;ie<E;++ie){ie==E-1&&(q=oe);for(let Z=0;Z<w;++Z)j[Z].fill(0),j[Z][0]=s[A[Z]++],ut(R,o,j[Z]),ht(j[Z],D[Z]),dt(D[Z]);vt(D);for(let Z=0;Z<w;++Z)pt(D[Z],V[Z],ie*64)}let fe=0;for(let ie=0;ie<w;++ie){const Z=n[e.idx[ie]].type;for(let ye=8*Y;ye<8*Y+ge;++ye){fe=ce[ie][ye];for(let Pe=0;Pe<_;++Pe){const _e=Pe*64+(ye&7)*8;Q.setUint16(fe+0*2*Z,V[ie][_e+0],!0),Q.setUint16(fe+1*2*Z,V[ie][_e+1],!0),Q.setUint16(fe+2*2*Z,V[ie][_e+2],!0),Q.setUint16(fe+3*2*Z,V[ie][_e+3],!0),Q.setUint16(fe+4*2*Z,V[ie][_e+4],!0),Q.setUint16(fe+5*2*Z,V[ie][_e+5],!0),Q.setUint16(fe+6*2*Z,V[ie][_e+6],!0),Q.setUint16(fe+7*2*Z,V[ie][_e+7],!0),fe+=8*2*Z}}if(_!=E)for(let ye=8*Y;ye<8*Y+ge;++ye){const Pe=ce[ie][ye]+8*_*2*Z,_e=_*64+(ye&7)*8;for(let Ne=0;Ne<q;++Ne)Q.setUint16(Pe+Ne*2*Z,V[ie][_e+Ne],!0)}}}for(var Ce=new Uint16Array(p),Q=new DataView(l.buffer),de=0;de<w;++de){n[e.idx[de]].decoded=!0;var Ue=n[e.idx[de]].type;if(n[de].type==2)for(var qe=0;qe<v;++qe){const Y=ce[de][qe];for(var Ee=0;Ee<p;++Ee)Ce[Ee]=Q.getUint16(Y+Ee*2*Ue,!0);for(var Ee=0;Ee<p;++Ee)Q.setFloat32(Y+Ee*2*Ue,M(Ce[Ee]),!0)}}}function ut(e,r,n){for(var o,s=1;s<64;)o=r[e.value],o==65280?s=64:o>>8==255?s+=o&255:(n[s]=o,s++),e.value++}function ht(e,r){r[0]=M(e[0]),r[1]=M(e[1]),r[2]=M(e[5]),r[3]=M(e[6]),r[4]=M(e[14]),r[5]=M(e[15]),r[6]=M(e[27]),r[7]=M(e[28]),r[8]=M(e[2]),r[9]=M(e[4]),r[10]=M(e[7]),r[11]=M(e[13]),r[12]=M(e[16]),r[13]=M(e[26]),r[14]=M(e[29]),r[15]=M(e[42]),r[16]=M(e[3]),r[17]=M(e[8]),r[18]=M(e[12]),r[19]=M(e[17]),r[20]=M(e[25]),r[21]=M(e[30]),r[22]=M(e[41]),r[23]=M(e[43]),r[24]=M(e[9]),r[25]=M(e[11]),r[26]=M(e[18]),r[27]=M(e[24]),r[28]=M(e[31]),r[29]=M(e[40]),r[30]=M(e[44]),r[31]=M(e[53]),r[32]=M(e[10]),r[33]=M(e[19]),r[34]=M(e[23]),r[35]=M(e[32]),r[36]=M(e[39]),r[37]=M(e[45]),r[38]=M(e[52]),r[39]=M(e[54]),r[40]=M(e[20]),r[41]=M(e[22]),r[42]=M(e[33]),r[43]=M(e[38]),r[44]=M(e[46]),r[45]=M(e[51]),r[46]=M(e[55]),r[47]=M(e[60]),r[48]=M(e[21]),r[49]=M(e[34]),r[50]=M(e[37]),r[51]=M(e[47]),r[52]=M(e[50]),r[53]=M(e[56]),r[54]=M(e[59]),r[55]=M(e[61]),r[56]=M(e[35]),r[57]=M(e[36]),r[58]=M(e[48]),r[59]=M(e[49]),r[60]=M(e[57]),r[61]=M(e[58]),r[62]=M(e[62]),r[63]=M(e[63])}function dt(e){const r=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),s=.5*Math.cos(3*3.14159/16),l=.5*Math.cos(5*3.14159/16),p=.5*Math.cos(3*3.14159/8),v=.5*Math.cos(7*3.14159/16);for(var w=new Array(4),_=new Array(4),E=new Array(4),m=new Array(4),oe=0;oe<8;++oe){var C=oe*8;w[0]=o*e[C+2],w[1]=p*e[C+2],w[2]=o*e[C+6],w[3]=p*e[C+6],_[0]=n*e[C+1]+s*e[C+3]+l*e[C+5]+v*e[C+7],_[1]=s*e[C+1]-v*e[C+3]-n*e[C+5]-l*e[C+7],_[2]=l*e[C+1]-n*e[C+3]+v*e[C+5]+s*e[C+7],_[3]=v*e[C+1]-l*e[C+3]+s*e[C+5]-n*e[C+7],E[0]=r*(e[C+0]+e[C+4]),E[3]=r*(e[C+0]-e[C+4]),E[1]=w[0]+w[3],E[2]=w[1]-w[2],m[0]=E[0]+E[1],m[1]=E[3]+E[2],m[2]=E[3]-E[2],m[3]=E[0]-E[1],e[C+0]=m[0]+_[0],e[C+1]=m[1]+_[1],e[C+2]=m[2]+_[2],e[C+3]=m[3]+_[3],e[C+4]=m[3]-_[3],e[C+5]=m[2]-_[2],e[C+6]=m[1]-_[1],e[C+7]=m[0]-_[0]}for(var R=0;R<8;++R)w[0]=o*e[16+R],w[1]=p*e[16+R],w[2]=o*e[48+R],w[3]=p*e[48+R],_[0]=n*e[8+R]+s*e[24+R]+l*e[40+R]+v*e[56+R],_[1]=s*e[8+R]-v*e[24+R]-n*e[40+R]-l*e[56+R],_[2]=l*e[8+R]-n*e[24+R]+v*e[40+R]+s*e[56+R],_[3]=v*e[8+R]-l*e[24+R]+s*e[40+R]-n*e[56+R],E[0]=r*(e[R]+e[32+R]),E[3]=r*(e[R]-e[32+R]),E[1]=w[0]+w[3],E[2]=w[1]-w[2],m[0]=E[0]+E[1],m[1]=E[3]+E[2],m[2]=E[3]-E[2],m[3]=E[0]-E[1],e[0+R]=m[0]+_[0],e[8+R]=m[1]+_[1],e[16+R]=m[2]+_[2],e[24+R]=m[3]+_[3],e[32+R]=m[3]-_[3],e[40+R]=m[2]-_[2],e[48+R]=m[1]-_[1],e[56+R]=m[0]-_[0]}function vt(e){for(var r=0;r<64;++r){var n=e[0][r],o=e[1][r],s=e[2][r];e[0][r]=n+1.5747*s,e[1][r]=n-.1873*o-.4682*s,e[2][r]=n+1.8556*o}}function pt(e,r,n){for(var o=0;o<64;++o)r[n+o]=Ze.toHalfFloat(ft(e[o]))}function ft(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(b,Math.abs(e)-1)}function Dr(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function gt(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(Ur(r)),o=new Uint8Array(n.length);return Fr(n),Ar(n,o),new DataView(o.buffer)}function vr(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=sr(r),o=new Uint8Array(n.length);return Fr(n),Ar(n,o),new DataView(o.buffer)}function mt(e){for(var r=e.viewer,n={value:e.offset.value},o=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),s=new Uint8Array(8192),l=0,p=new Array(e.channels),v=0;v<e.channels;v++)p[v]={},p[v].start=l,p[v].end=p[v].start,p[v].nx=e.width,p[v].ny=e.lines,p[v].size=e.type,l+=p[v].nx*p[v].ny*p[v].size;var w=je(r,n),_=je(r,n);if(_>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(w<=_)for(var v=0;v<_-w+1;v++)s[v+w]=Ge(r,n);var E=new Uint16Array(65536),m=P(s,E),oe=me(r,n);Rr(e.array,r,n,oe,o,l);for(var v=0;v<e.channels;++v)for(var C=p[v],R=0;R<p[v].size;++R)ot(o,C.start+R,C.nx,C.size,C.ny,C.nx*C.size,m);lt(E,o,l);for(var A=0,D=new Uint8Array(o.buffer.byteLength),j=0;j<e.lines;j++)for(var V=0;V<e.channels;V++){var C=p[V],ce=C.nx*C.size,ge=new Uint8Array(o.buffer,C.end*2,ce*2);D.set(ge,A),A+=ce*2,C.end+=ce}return new DataView(D.buffer)}function _t(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=sr(r);const o=e.lines*e.channels*e.width,s=e.type==1?new Uint16Array(o):new Uint32Array(o);let l=0,p=0;const v=new Array(4);for(let w=0;w<e.lines;w++)for(let _=0;_<e.channels;_++){let E=0;switch(e.type){case 1:v[0]=l,v[1]=v[0]+e.width,l=v[1]+e.width;for(let m=0;m<e.width;++m){const oe=n[v[0]++]<<8|n[v[1]++];E+=oe,s[p]=E,p++}break;case 2:v[0]=l,v[1]=v[0]+e.width,v[2]=v[1]+e.width,l=v[2]+e.width;for(let m=0;m<e.width;++m){const oe=n[v[0]++]<<24|n[v[1]++]<<16|n[v[2]++]<<8;E+=oe,s[p]=E,p++}break}}return new DataView(s.buffer)}function Or(e){var r=e.viewer,n={value:e.offset.value},o=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),s={version:we(r,n),unknownUncompressedSize:we(r,n),unknownCompressedSize:we(r,n),acCompressedSize:we(r,n),dcCompressedSize:we(r,n),rleCompressedSize:we(r,n),rleUncompressedSize:we(r,n),rleRawSize:we(r,n),totalAcUncompressedCount:we(r,n),totalDcUncompressedCount:we(r,n),acCompression:we(r,n)};if(s.version<2)throw"EXRLoader.parse: "+Ve.compression+" version "+s.version+" is unsupported";for(var l=new Array,p=je(r,n)-2;p>0;){var v=ir(r.buffer,n),w=Ge(r,n),_=w>>2&3,E=(w>>4)-1,m=new Int8Array([E])[0],oe=Ge(r,n);l.push({name:v,index:m,type:oe,compression:_}),p-=v.length+3}for(var C=Ve.channels,R=new Array(e.channels),A=0;A<e.channels;++A){var D=R[A]={},j=C[A];D.name=j.name,D.compression=0,D.decoded=!1,D.type=j.pixelType,D.pLinear=j.pLinear,D.width=e.width,D.height=e.lines}for(var V={idx:new Array(3)},ce=0;ce<e.channels;++ce)for(var D=R[ce],A=0;A<l.length;++A){var ge=l[A];D.name==ge.name&&(D.compression=ge.compression,ge.index>=0&&(V.idx[ge.index]=ce),D.offset=ce)}if(s.acCompressedSize>0)switch(s.acCompression){case 0:var Q=new Uint16Array(s.totalAcUncompressedCount);Rr(e.array,r,n,s.acCompressedSize,Q,s.totalAcUncompressedCount);break;case 1:var q=e.array.slice(n.value,n.value+s.totalAcUncompressedCount),Ce=sr(q),Q=new Uint16Array(Ce.buffer);n.value+=s.totalAcUncompressedCount;break}if(s.dcCompressedSize>0){var de={array:e.array,offset:n,size:s.dcCompressedSize},Ue=new Uint16Array(vr(de).buffer);n.value+=s.dcCompressedSize}if(s.rleRawSize>0){var q=e.array.slice(n.value,n.value+s.rleCompressedSize),Ce=sr(q),qe=Ur(Ce.buffer);n.value+=s.rleCompressedSize}for(var Ee=0,Y=new Array(R.length),A=0;A<Y.length;++A)Y[A]=new Array;for(var fe=0;fe<e.lines;++fe)for(var ie=0;ie<R.length;++ie)Y[ie].push(Ee),Ee+=R[ie].width*e.type*2;ct(V,Y,R,Q,Ue,o);for(var A=0;A<R.length;++A){var D=R[A];if(!D.decoded)switch(D.compression){case 2:for(var Z=0,ye=0,fe=0;fe<e.lines;++fe){for(var Pe=Y[A][Z],_e=0;_e<D.width;++_e){for(var Ne=0;Ne<2*D.type;++Ne)o[Pe++]=qe[ye+Ne*D.width*D.height];ye++}Z++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(o.buffer)}function ir(e,r){for(var n=new Uint8Array(e),o=0;n[r.value+o]!=0;)o+=1;var s=new TextDecoder().decode(n.slice(r.value,r.value+o));return r.value=r.value+o+1,s}function wt(e,r,n){var o=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+n));return r.value=r.value+n,o}function Et(e,r){var n=$e(e,r),o=me(e,r);return[n,o]}function yt(e,r){var n=me(e,r),o=me(e,r);return[n,o]}function $e(e,r){var n=e.getInt32(r.value,!0);return r.value=r.value+4,n}function me(e,r){var n=e.getUint32(r.value,!0);return r.value=r.value+4,n}function Nr(e,r){var n=e[r.value];return r.value=r.value+1,n}function Ge(e,r){var n=e.getUint8(r.value);return r.value=r.value+1,n}const we=function(e,r){let n;return"getBigInt64"in DataView.prototype?n=Number(e.getBigInt64(r.value,!0)):n=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,n};function pe(e,r){var n=e.getFloat32(r.value,!0);return r.value+=4,n}function St(e,r){return Ze.toHalfFloat(pe(e,r))}function M(e){var r=(e&31744)>>10,n=e&1023;return(e>>15?-1:1)*(r?r===31?n?NaN:1/0:Math.pow(2,r-15)*(1+n/1024):6103515625e-14*(n/1024))}function je(e,r){var n=e.getUint16(r.value,!0);return r.value+=2,n}function Mt(e,r){return M(je(e,r))}function It(e,r,n,o){for(var s=n.value,l=[];n.value<s+o-1;){var p=ir(r,n),v=$e(e,n),w=Ge(e,n);n.value+=3;var _=$e(e,n),E=$e(e,n);l.push({name:p,pixelType:v,pLinear:w,xSampling:_,ySampling:E})}return n.value+=1,l}function bt(e,r){var n=pe(e,r),o=pe(e,r),s=pe(e,r),l=pe(e,r),p=pe(e,r),v=pe(e,r),w=pe(e,r),_=pe(e,r);return{redX:n,redY:o,greenX:s,greenY:l,blueX:p,blueY:v,whiteX:w,whiteY:_}}function xt(e,r){var n=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],o=Ge(e,r);return n[o]}function Tt(e,r){var n=me(e,r),o=me(e,r),s=me(e,r),l=me(e,r);return{xMin:n,yMin:o,xMax:s,yMax:l}}function Ct(e,r){var n=["INCREASING_Y"],o=Ge(e,r);return n[o]}function Rt(e,r){var n=pe(e,r),o=pe(e,r);return[n,o]}function Ft(e,r){var n=pe(e,r),o=pe(e,r),s=pe(e,r);return[n,o,s]}function At(e,r,n,o,s){if(o==="string"||o==="stringvector"||o==="iccProfile")return wt(r,n,s);if(o==="chlist")return It(e,r,n,s);if(o==="chromaticities")return bt(e,n);if(o==="compression")return xt(e,n);if(o==="box2i")return Tt(e,n);if(o==="lineOrder")return Ct(e,n);if(o==="float")return pe(e,n);if(o==="v2f")return Rt(e,n);if(o==="v3f")return Ft(e,n);if(o==="int")return $e(e,n);if(o==="rational")return Et(e,n);if(o==="timecode")return yt(e,n);if(o==="preview")return n.value+=s,"skipped";n.value+=s}function Ut(e,r,n){const o={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";o.version=e.getUint8(4);const s=e.getUint8(5);o.spec={singleTile:!!(s&2),longName:!!(s&4),deepFormat:!!(s&8),multiPart:!!(s&16)},n.value=8;for(var l=!0;l;){var p=ir(r,n);if(p==0)l=!1;else{var v=ir(r,n),w=me(e,n),_=At(e,r,n,v,w);_===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${v}'.`):o[p]=_}}if(s&-5)throw console.error("EXRHeader:",o),"THREE.EXRLoader: provided file is currently unsupported.";return o}function Dt(e,r,n,o,s){const l={size:0,viewer:r,array:n,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Je?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":l.lines=1,l.uncompress=Dr;break;case"RLE_COMPRESSION":l.lines=1,l.uncompress=gt;break;case"ZIPS_COMPRESSION":l.lines=1,l.uncompress=vr;break;case"ZIP_COMPRESSION":l.lines=16,l.uncompress=vr;break;case"PIZ_COMPRESSION":l.lines=32,l.uncompress=mt;break;case"PXR24_COMPRESSION":l.lines=16,l.uncompress=_t;break;case"DWAA_COMPRESSION":l.lines=32,l.uncompress=Or;break;case"DWAB_COMPRESSION":l.lines=256,l.uncompress=Or;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(l.scanlineBlockSize=l.lines,l.type==1)switch(s){case De:l.getter=Mt,l.inputSize=2;break;case Me:l.getter=je,l.inputSize=2;break}else if(l.type==2)switch(s){case De:l.getter=pe,l.inputSize=4;break;case Me:l.getter=St,l.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+l.type+" for "+e.compression+".";l.blockCount=(e.dataWindow.yMax+1)/l.scanlineBlockSize;for(var p=0;p<l.blockCount;p++)we(r,o);l.outputChannels=l.channels==3?4:l.channels;const v=l.width*l.height*l.outputChannels;switch(s){case De:l.byteArray=new Float32Array(v),l.channels<l.outputChannels&&l.byteArray.fill(1,0,v);break;case Me:l.byteArray=new Uint16Array(v),l.channels<l.outputChannels&&l.byteArray.fill(15360,0,v);break;default:console.error("THREE.EXRLoader: unsupported type: ",s);break}return l.bytesPerLine=l.width*l.inputSize*l.channels,l.outputChannels==4?l.format=rr:l.format=Pt,Je?l.colorSpace="srgb-linear":l.encoding=3e3,l}const or=new DataView(t),Ot=new Uint8Array(t),Ye={value:0},Ve=Ut(or,t,Ye),B=Dt(Ve,or,Ot,Ye,this.type),Br={value:0},Nt={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<B.height/B.scanlineBlockSize;e++){const r=me(or,Ye);B.size=me(or,Ye),B.lines=r+B.scanlineBlockSize>B.height?B.height-r:B.scanlineBlockSize;const o=B.size<B.lines*B.bytesPerLine?B.uncompress(B):Dr(B);Ye.value+=B.size;for(let s=0;s<B.scanlineBlockSize;s++){const l=s+e*B.scanlineBlockSize;if(l>=B.height)break;for(let p=0;p<B.channels;p++){const v=Nt[Ve.channels[p].name];for(let w=0;w<B.width;w++){Br.value=(s*(B.channels*B.width)+p*B.width+w)*B.inputSize;const _=(B.height-1-l)*(B.width*B.outputChannels)+w*B.outputChannels+v;B.byteArray[_]=B.getter(o,Br)}}}}return{header:Ve,width:B.width,height:B.height,data:B.byteArray,format:B.format,[Je?"colorSpace":"encoding"]:B[Je?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,i,c,u){function d(h,g){Je?h.colorSpace=g.colorSpace:h.encoding=g.encoding,h.minFilter=Re,h.magFilter=Re,h.generateMipmaps=!1,h.flipY=!1,i&&i(h,g)}return super.load(t,d,c,u)}}const Rn=3e3,Fn=3001,Qr=(a,t,i)=>{let c;switch(a){case mr:c=new Uint8ClampedArray(t*i*4);break;case Me:c=new Uint16Array(t*i*4);break;case jt:c=new Uint32Array(t*i*4);break;case $t:c=new Int8Array(t*i*4);break;case Xt:c=new Int16Array(t*i*4);break;case Wt:c=new Int32Array(t*i*4);break;case De:c=new Float32Array(t*i*4);break;default:throw new Error("Unsupported data type")}return c};let lr;const An=(a,t,i,c)=>{if(lr!==void 0)return lr;const u=new Xr(1,1,c);t.setRenderTarget(u);const d=new Er(new Wr,new Yt({color:16777215}));t.render(d,i),t.setRenderTarget(null);const h=Qr(a,u.width,u.height);return t.readRenderTargetPixels(u,0,0,u.width,u.height,h),u.dispose(),d.geometry.dispose(),d.material.dispose(),lr=h[0]!==0,lr};class Sr{constructor(t){var i,c,u,d,h,g,f,y,I,T,x,U,W,re,k,N;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(se){throw this._renderer.setRenderTarget(null),se}this._renderer.setRenderTarget(null)},this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const he={format:rr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((i=t.renderTargetOptions)===null||i===void 0?void 0:i.anisotropy)!==void 0?(c=t.renderTargetOptions)===null||c===void 0?void 0:c.anisotropy:1,generateMipmaps:((u=t.renderTargetOptions)===null||u===void 0?void 0:u.generateMipmaps)!==void 0?(d=t.renderTargetOptions)===null||d===void 0?void 0:d.generateMipmaps:!1,magFilter:((h=t.renderTargetOptions)===null||h===void 0?void 0:h.magFilter)!==void 0?(g=t.renderTargetOptions)===null||g===void 0?void 0:g.magFilter:Re,minFilter:((f=t.renderTargetOptions)===null||f===void 0?void 0:f.minFilter)!==void 0?(y=t.renderTargetOptions)===null||y===void 0?void 0:y.minFilter:Re,samples:((I=t.renderTargetOptions)===null||I===void 0?void 0:I.samples)!==void 0?(T=t.renderTargetOptions)===null||T===void 0?void 0:T.samples:void 0,wrapS:((x=t.renderTargetOptions)===null||x===void 0?void 0:x.wrapS)!==void 0?(U=t.renderTargetOptions)===null||U===void 0?void 0:U.wrapS:ke,wrapT:((W=t.renderTargetOptions)===null||W===void 0?void 0:W.wrapT)!==void 0?(re=t.renderTargetOptions)===null||re===void 0?void 0:re.wrapT:ke};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=Sr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Zr,this._camera=new zt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!An(this._type,this._renderer,this._camera,he)){let se;switch(this._type){case Me:se=this._renderer.extensions.has("EXT_color_buffer_float")?De:void 0;break}se!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${De}`),this._type=se):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Er(new Wr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Xr(this.width,this.height,he),this._renderTarget.texture.mapping=((k=t.renderTargetOptions)===null||k===void 0?void 0:k.mapping)!==void 0?(N=t.renderTargetOptions)===null||N===void 0?void 0:N.mapping:ur}static instantiateRenderer(){const t=new Gt;return t.setSize(128,128),t}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=Qr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const i=new Zt(this.toArray(),this.width,this.height,rr,this._type,(t==null?void 0:t.mapping)||ur,(t==null?void 0:t.wrapS)||ke,(t==null?void 0:t.wrapT)||ke,(t==null?void 0:t.magFilter)||Re,(t==null?void 0:t.minFilter)||Re,(t==null?void 0:t.anisotropy)||1,gr);return i.generateMipmaps=(t==null?void 0:t.generateMipmaps)!==void 0?t==null?void 0:t.generateMipmaps:!1,i}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof yr&&Object.values(this.material.uniforms).forEach(i=>{i.value instanceof ze&&i.value.dispose()}),Object.values(this.material).forEach(i=>{i instanceof ze&&i.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const Un=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Dn=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class On extends yr{constructor({gamma:t,offsetHdr:i,offsetSdr:c,gainMapMin:u,gainMapMax:d,maxDisplayBoost:h,hdrCapacityMin:g,hdrCapacityMax:f,sdr:y,gainMap:I}){super({name:"GainMapDecoderMaterial",vertexShader:Un,fragmentShader:Dn,uniforms:{sdr:{value:y},gainMap:{value:I},gamma:{value:new Ke(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new Ke().fromArray(i)},offsetSdr:{value:new Ke().fromArray(c)},gainMapMin:{value:new Ke().fromArray(u)},gainMapMax:{value:new Ke().fromArray(d)},weightFactor:{value:(Math.log2(h)-g)/(f-g)}},blending:Jt,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=h,this._hdrCapacityMin=g,this._hdrCapacityMax=f,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const i=this.uniforms.gamma.value;i.x=1/t[0],i.y=1/t[1],i.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class et extends Error{}class rt extends Error{}const Qe=(a,t,i)=>{var c;let u;const d=(c=a.attributes.getNamedItem(t))===null||c===void 0?void 0:c.nodeValue;if(d)u=d;else{const h=a.getElementsByTagName(t)[0];if(h){const g=h.getElementsByTagName("rdf:li");if(g.length===3)u=Array.from(g).map(f=>f.innerHTML);else throw new Error(`Gainmap metadata contains an array of items for ${t} but its length is not 3`)}else{if(i)return i;throw new Error(`Can't find ${t} in gainmap metadata`)}}return u},Nn=a=>{var t,i;let c;typeof TextDecoder<"u"?c=new TextDecoder().decode(a):c=a.toString();let u=c.indexOf("<x:xmpmeta");const d=new DOMParser;for(;u!==-1;){const h=c.indexOf("x:xmpmeta>",u);c.slice(u,h+10);const g=c.slice(u,h+10);try{const y=d.parseFromString(g,"text/xml").getElementsByTagName("rdf:Description")[0],I=Qe(y,"hdrgm:GainMapMin","0"),T=Qe(y,"hdrgm:GainMapMax"),x=Qe(y,"hdrgm:Gamma","1"),U=Qe(y,"hdrgm:OffsetSDR","0.015625"),W=Qe(y,"hdrgm:OffsetHDR","0.015625");let re=(t=y.attributes.getNamedItem("hdrgm:HDRCapacityMin"))===null||t===void 0?void 0:t.nodeValue;re||(re="0");const k=(i=y.attributes.getNamedItem("hdrgm:HDRCapacityMax"))===null||i===void 0?void 0:i.nodeValue;if(!k)throw new Error("Incomplete gainmap metadata");return{gainMapMin:Array.isArray(I)?I.map(N=>parseFloat(N)):[parseFloat(I),parseFloat(I),parseFloat(I)],gainMapMax:Array.isArray(T)?T.map(N=>parseFloat(N)):[parseFloat(T),parseFloat(T),parseFloat(T)],gamma:Array.isArray(x)?x.map(N=>parseFloat(N)):[parseFloat(x),parseFloat(x),parseFloat(x)],offsetSdr:Array.isArray(U)?U.map(N=>parseFloat(N)):[parseFloat(U),parseFloat(U),parseFloat(U)],offsetHdr:Array.isArray(W)?W.map(N=>parseFloat(N)):[parseFloat(W),parseFloat(W),parseFloat(W)],hdrCapacityMin:parseFloat(re),hdrCapacityMax:parseFloat(k)}}catch{}u=c.indexOf("<x:xmpmeta",h)}};class Bn{constructor(t){this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((i,c)=>{const u=this.options.debug,d=new DataView(t.buffer);if(d.getUint16(0)!==65496){c(new Error("Not a valid jpeg"));return}const h=d.byteLength;let g=2,f=0,y;for(;g<h;){if(++f>250){c(new Error(`Found no marker after ${f} loops 😵`));return}if(d.getUint8(g)!==255){c(new Error(`Not a valid marker at offset 0x${g.toString(16)}, found: 0x${d.getUint8(g).toString(16)}`));return}if(y=d.getUint8(g+1),u&&console.log(`Marker: ${y.toString(16)}`),y===226){u&&console.log("Found APP2 marker (0xffe2)");const I=g+4;if(d.getUint32(I)===1297106432){const T=I+4;let x;if(d.getUint16(T)===18761)x=!1;else if(d.getUint16(T)===19789)x=!0;else{c(new Error("No valid endianness marker found in TIFF header"));return}if(d.getUint16(T+2,!x)!==42){c(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const U=d.getUint32(T+4,!x);if(U<8){c(new Error("Not valid TIFF data! (First offset less than 8)"));return}const W=T+U,re=d.getUint16(W,!x),k=W+2;let N=0;for(let z=k;z<k+12*re;z+=12)d.getUint16(z,!x)===45057&&(N=d.getUint32(z+8,!x));const se=W+2+re*12+4,le=[];for(let z=se;z<se+N*16;z+=16){const L={MPType:d.getUint32(z,!x),size:d.getUint32(z+4,!x),dataOffset:d.getUint32(z+8,!x),dependantImages:d.getUint32(z+12,!x),start:-1,end:-1,isFII:!1};L.dataOffset?(L.start=T+L.dataOffset,L.isFII=!1):(L.start=0,L.isFII=!0),L.end=L.start+L.size,le.push(L)}if(this.options.extractNonFII&&le.length){const z=new Blob([d]),L=[];for(const te of le){if(te.isFII&&!this.options.extractFII)continue;const S=z.slice(te.start,te.end+1,"image/jpeg");L.push(S)}i(L)}}}g+=2+d.getUint16(g+2)}})}}const kn=async a=>{const t=Nn(a);if(!t)throw new rt("Gain map XMP metadata not found");const c=await new Bn({extractFII:!0,extractNonFII:!0}).extract(a);if(c.length!==2)throw new et("Gain map recovery image not found");return{sdr:new Uint8Array(await c[0].arrayBuffer()),gainMap:new Uint8Array(await c[1].arrayBuffer()),metadata:t}},Hr=a=>new Promise((t,i)=>{const c=document.createElement("img");c.onload=()=>{t(c)},c.onerror=u=>{i(u)},c.src=URL.createObjectURL(a)});class tt extends Vt{constructor(t,i){super(i),t&&(this._renderer=t),this._internalLoadingManager=new qt}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=new On({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new ze,sdr:new ze});return new Sr({width:16,height:16,type:Me,colorSpace:gr,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(t,i,c,u){const d=u?new Blob([u],{type:"image/jpeg"}):void 0,h=new Blob([c],{type:"image/jpeg"});let g,f,y=!1;if(typeof createImageBitmap>"u"){const x=await Promise.all([d?Hr(d):Promise.resolve(void 0),Hr(h)]);f=x[0],g=x[1],y=!0}else{const x=await Promise.all([d?createImageBitmap(d,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(h,{imageOrientation:"flipY"})]);f=x[0],g=x[1]}const I=new ze(f||new ImageData(2,2),ur,ke,ke,Re,kr,rr,mr,1,gr);I.flipY=y,I.needsUpdate=!0;const T=new ze(g,ur,ke,ke,Re,kr,rr,mr,1,Kt);T.flipY=y,T.needsUpdate=!0,t.width=g.width,t.height=g.height,t.material.gainMap=I,t.material.sdr=T,t.material.gainMapMin=i.gainMapMin,t.material.gainMapMax=i.gainMapMax,t.material.offsetHdr=i.offsetHdr,t.material.offsetSdr=i.offsetSdr,t.material.gamma=i.gamma,t.material.hdrCapacityMin=i.hdrCapacityMin,t.material.hdrCapacityMax=i.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,i.hdrCapacityMax),t.material.needsUpdate=!0,t.render()}}class Ln extends tt{load([t,i,c],u,d,h){const g=this.prepareQuadRenderer();let f,y,I;const T=async()=>{if(f&&y&&I){try{await this.render(g,I,f,y)}catch(b){this.manager.itemError(t),this.manager.itemError(i),this.manager.itemError(c),typeof h=="function"&&h(b),g.disposeOnDemandRenderer();return}typeof u=="function"&&u(g),this.manager.itemEnd(t),this.manager.itemEnd(i),this.manager.itemEnd(c),g.disposeOnDemandRenderer()}};let x=!0,U=0,W=0,re=!0,k=0,N=0,he=!0,se=0,le=0;const z=()=>{if(typeof d=="function"){const b=U+k+se,P=W+N+le,X=x&&re&&he;d(new ProgressEvent("progress",{lengthComputable:X,loaded:P,total:b}))}};this.manager.itemStart(t),this.manager.itemStart(i),this.manager.itemStart(c);const L=new cr(this._internalLoadingManager);L.setResponseType("arraybuffer"),L.setRequestHeader(this.requestHeader),L.setPath(this.path),L.setWithCredentials(this.withCredentials),L.load(t,async b=>{if(typeof b=="string")throw new Error("Invalid sdr buffer");f=b,await T()},b=>{x=b.lengthComputable,W=b.loaded,U=b.total,z()},b=>{this.manager.itemError(t),typeof h=="function"&&h(b)});const te=new cr(this._internalLoadingManager);te.setResponseType("arraybuffer"),te.setRequestHeader(this.requestHeader),te.setPath(this.path),te.setWithCredentials(this.withCredentials),te.load(i,async b=>{if(typeof b=="string")throw new Error("Invalid gainmap buffer");y=b,await T()},b=>{re=b.lengthComputable,N=b.loaded,k=b.total,z()},b=>{this.manager.itemError(i),typeof h=="function"&&h(b)});const S=new cr(this._internalLoadingManager);return S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(c,async b=>{if(typeof b!="string")throw new Error("Invalid metadata string");I=JSON.parse(b),await T()},b=>{he=b.lengthComputable,le=b.loaded,se=b.total,z()},b=>{this.manager.itemError(c),typeof h=="function"&&h(b)}),g}}class Hn extends tt{load(t,i,c,u){const d=this.prepareQuadRenderer(),h=new cr(this._internalLoadingManager);return h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setPath(this.path),h.setWithCredentials(this.withCredentials),this.manager.itemStart(t),h.load(t,async g=>{if(typeof g=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const f=new Uint8Array(g);let y,I,T;try{const x=await kn(f);y=x.sdr,I=x.gainMap,T=x.metadata}catch(x){if(x instanceof rt||x instanceof et)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),T={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},y=f;else throw x}try{await this.render(d,T,y,I)}catch(x){this.manager.itemError(t),typeof u=="function"&&u(x),d.disposeOnDemandRenderer();return}typeof i=="function"&&i(d),this.manager.itemEnd(t),d.disposeOnDemandRenderer()},c,g=>{this.manager.itemError(t),typeof u=="function"&&u(g)}),d}}const nr={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},nt="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",We=a=>Array.isArray(a),Mr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function dr({files:a=Mr,path:t="",preset:i=void 0,encoding:c=void 0,extensions:u}={}){let d=null,h=!1;i&&(Ir(i),a=nr[i],t=nt),h=We(a);const{extension:g,isCubemap:f}=br(a);if(d=xr(g),!d)throw new Error("useEnvironment: Unrecognized file extension: "+a);const y=tr(U=>U.gl);K.useLayoutEffect(()=>{if(g!=="webp"&&g!=="jpg"&&g!=="jpeg")return;function U(){hr.clear(d,h?[a]:a)}y.domElement.addEventListener("webglcontextlost",U,{once:!0})},[a,y.domElement]);const I=hr(d,h?[a]:a,U=>{(g==="webp"||g==="jpg"||g==="jpeg")&&U.setRenderer(y),U.setPath==null||U.setPath(t),u&&u(U)});let T=h?I[0]:I;if(g==="jpg"||g==="jpeg"||g==="webp"){var x;T=(x=T.renderTarget)==null?void 0:x.texture}return T.mapping=f?Qt:en,"colorSpace"in T?T.colorSpace=c??f?"srgb":"srgb-linear":T.encoding=c??f?Fn:Rn,T}const Pn={files:Mr,path:"",preset:void 0,extensions:void 0};dr.preload=a=>{const t={...Pn,...a};let{files:i,path:c=""}=t;const{preset:u,extensions:d}=t;u&&(Ir(u),i=nr[u],c=nt);const{extension:h}=br(i);if(h==="webp"||h==="jpg"||h==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const g=xr(h);if(!g)throw new Error("useEnvironment: Unrecognized file extension: "+i);hr.preload(g,We(i)?[i]:i,f=>{f.setPath==null||f.setPath(c),d&&d(f)})};const zn={files:Mr,preset:void 0};dr.clear=a=>{const t={...zn,...a};let{files:i}=t;const{preset:c}=t;c&&(Ir(c),i=nr[c]);const{extension:u}=br(i),d=xr(u);if(!d)throw new Error("useEnvironment: Unrecognized file extension: "+i);hr.clear(d,We(i)?[i]:i)};function Ir(a){if(!(a in nr))throw new Error("Preset must be one of: "+Object.keys(nr).join(", "))}function br(a){var t;const i=We(a)&&a.length===6,c=We(a)&&a.length===3&&a.some(h=>h.endsWith("json")),u=We(a)?a[0]:a;return{extension:i?"cube":c?"webp":u.startsWith("data:application/exr")?"exr":u.startsWith("data:application/hdr")?"hdr":u.startsWith("data:image/jpeg")?"jpg":(t=u.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:i,isGainmap:c}}function xr(a){return a==="cube"?rn:a==="hdr"?Tn:a==="exr"?Cn:a==="jpg"||a==="jpeg"?Hn:a==="webp"?Ln:null}const Gn=a=>a.current&&a.current.isScene,Zn=a=>Gn(a)?a.current:a;function Tr(a,t,i,c,u={}){var d,h,g,f,y;u={backgroundBlurriness:(d=u.blur)!==null&&d!==void 0?d:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...u};const I=Zn(t||i),T=I.background,x=I.environment,U={backgroundBlurriness:I.backgroundBlurriness,backgroundIntensity:I.backgroundIntensity,backgroundRotation:(h=(g=I.backgroundRotation)==null||g.clone==null?void 0:g.clone())!==null&&h!==void 0?h:[0,0,0],environmentIntensity:I.environmentIntensity,environmentRotation:(f=(y=I.environmentRotation)==null||y.clone==null?void 0:y.clone())!==null&&f!==void 0?f:[0,0,0]};return a!=="only"&&(I.environment=c),a&&(I.background=c),Lr(I,u),()=>{a!=="only"&&(I.environment=x),a&&(I.background=T),Lr(I,U)}}function Cr({scene:a,background:t=!1,map:i,...c}){const u=tr(d=>d.scene);return K.useLayoutEffect(()=>{if(i)return Tr(t,a,u,i,c)}),null}function at({background:a=!1,scene:t,blur:i,backgroundBlurriness:c,backgroundIntensity:u,backgroundRotation:d,environmentIntensity:h,environmentRotation:g,...f}){const y=dr(f),I=tr(T=>T.scene);return K.useLayoutEffect(()=>Tr(a,t,I,y,{blur:i,backgroundBlurriness:c,backgroundIntensity:u,backgroundRotation:d,environmentIntensity:h,environmentRotation:g})),null}function Wn({children:a,near:t=1,far:i=1e3,resolution:c=256,frames:u=1,map:d,background:h=!1,blur:g,backgroundBlurriness:f,backgroundIntensity:y,backgroundRotation:I,environmentIntensity:T,environmentRotation:x,scene:U,files:W,path:re,preset:k=void 0,extensions:N}){const he=tr(S=>S.gl),se=tr(S=>S.scene),le=K.useRef(null),[z]=K.useState(()=>new Zr),L=K.useMemo(()=>{const S=new tn(c);return S.texture.type=Me,S},[c]);K.useLayoutEffect(()=>(u===1&&le.current.update(he,z),Tr(h,U,se,L.texture,{blur:g,backgroundBlurriness:f,backgroundIntensity:y,backgroundRotation:I,environmentIntensity:T,environmentRotation:x})),[a,z,L.texture,U,se,h,u,he]);let te=1;return $r(()=>{(u===1/0||te<u)&&(le.current.update(he,z),te++)}),K.createElement(K.Fragment,null,nn(K.createElement(K.Fragment,null,a,K.createElement("cubeCamera",{ref:le,args:[t,i,L]}),W||k?K.createElement(at,{background:!0,files:W,preset:k,path:re,extensions:N}):d?K.createElement(Cr,{background:!0,map:d,extensions:N}):null),z))}function Xn(a){var t,i,c,u;const d=dr(a),h=a.map||d;K.useMemo(()=>an({GroundProjectedEnvImpl:xn}),[]);const g=K.useMemo(()=>[h],[h]),f=(t=a.ground)==null?void 0:t.height,y=(i=a.ground)==null?void 0:i.radius,I=(c=(u=a.ground)==null?void 0:u.scale)!==null&&c!==void 0?c:1e3;return K.createElement(K.Fragment,null,K.createElement(Cr,on({},a,{map:h})),K.createElement("groundProjectedEnvImpl",{args:g,scale:I,height:f,radius:y}))}function $n(a){return a.ground?K.createElement(Xn,a):a.map?K.createElement(Cr,a):a.children?K.createElement(Wn,a):K.createElement(at,a)}const jn=()=>{K.useEffect(()=>{},[]),$r(()=>{});const a=K.useRef();return ue.jsxs(ue.Fragment,{children:[ue.jsx("mesh",{ref:a,children:ue.jsx("meshNormalMaterial",{})}),ue.jsxs("mesh",{ref:a,children:[ue.jsx(un,{args:[1,4,1]}),ue.jsx("meshNormalMaterial",{})]}),ue.jsx(hn,{fontSize:1,position:[0,5,0],children:"旋转文字"})]})};function Yn(){return ue.jsx(jn,{})}const Vn=()=>ue.jsx("div",{style:{height:"60vh"},children:ue.jsxs(sn,{dpr:[1,2],scene:{background:new ln(16777215)},gl:{alpha:!1},camera:{position:[0,0,40],fov:70},children:[ue.jsx($n,{background:!0,files:"/pano/city.jpg"}),ue.jsx(cn,{}),ue.jsx("axesHelper",{args:[10]}),ue.jsx("ambientLight",{intensity:Math.PI}),ue.jsx(Yn,{})]})}),qn=`import { Box, Environment, OrbitControls, Text } from '@react-three/drei'
import { Canvas, useFrame } from '@react-three/fiber'
import React, { useEffect, useRef } from 'react'
import * as THREE from 'three'

const TextD = () => {
  useEffect(() => {}, [])

  useFrame(() => {
    // console.log(pivotControl.current.rotation)
    // text.current.rotation.z += 0.01
  })
  const text = useRef()

  return (
    <>
      <mesh ref={text}>
        <meshNormalMaterial />
      </mesh>
      <mesh ref={text}>
        <Box args={[1, 4, 1]} />
        <meshNormalMaterial />
      </mesh>
      <Text fontSize={1} position={[0, 5, 0]}>
        旋转文字
      </Text>
    </>
  )
}

function Com() {
  return <TextD></TextD>
}
const DataDiff = () => {
  return (
    <div style={{ height: '60vh' }}>
      <Canvas
        dpr={[1, 2]}
        scene={{ background: new THREE.Color(0xffffff) }}
        gl={{ alpha: false }}
        camera={{ position: [0, 0, 40], fov: 70 }}
      >
        <Environment
          background={true} // can be true, false or "only" (which only sets the background) (default: false)
          files="/pano/city.jpg" // link to the hdr
        />
        <OrbitControls />
        <axesHelper args={[10]} />
        <ambientLight intensity={Math.PI} />
        <Com />
      </Canvas>
    </div>
  )
}

export default DataDiff
`,Kn=void 0,Jn=void 0,Qn={code:qn,title:Kn,desc:Jn},ea=!0,ra=Object.freeze(Object.defineProperty({__proto__:null,default:Vn,demoMeta:Qn,isDemo:ea},Symbol.toStringTag,{value:"Module"}));function Pr(a){const{Demo:t}={...zr(),...a.components};return t||na("Demo"),ue.jsx(t,{...ra})}function ta(a={}){const{wrapper:t}={...zr(),...a.components};return t?ue.jsx(t,{...a,children:ue.jsx(Pr,{...a})}):Pr(a)}function na(a,t){throw new Error("Expected component `"+a+"` to be defined: you likely forgot to import, pass, or provide it.")}const aa=Object.freeze(Object.defineProperty({__proto__:null,default:ta},Symbol.toStringTag,{value:"Module"})),it={};it.outlineInfo=Bt;it.main=aa;export{it as default};
