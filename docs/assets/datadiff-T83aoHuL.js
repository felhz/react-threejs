import{p as Gt}from"./datadiff_-FU1-d8Ot.js";import{r as z,j as de,u as Wr}from"./ssg-client-QCL6abap.js";import{M as Sr,I as Zt,S as Mr,D as Xr,R as Wt,a as jr,H as Me,F as Oe,b as We,L as Re,T as ze,c as rr,d as Xt,B as jt,V as Ze,e as $t,_ as $r,C as ke,f as Yr,O as Yt,P as Vr,W as qr,U as ur,g as Vt,h as qt,i as fr,j as Kt,k as Jt,l as Qt,m as en,n as mr,o as wr,p as cr,q as rn,r as tn,s as Pr,t as nn,N as an,u as tr,v as hr,w as on,E as sn,x as ln,y as cn,z as Kr,A as un,G as hn,J as Hr,K as dn,Q as Jr,X as zr}from"./react-three-fiber.esm-Wlljgie4.js";import{s as _r}from"./index-CSwHO5PT.js";import{O as vn}from"./OrbitControls-Co5GMNoC.js";import{B as pn,P as gn}from"./shapes-Ba5BUq89.js";import{T as fn}from"./Text-DAppf6MB.js";var Se=Uint8Array,Le=Uint16Array,Er=Uint32Array,Qr=new Se([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),et=new Se([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),mn=new Se([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rt=function(a,t){for(var i=new Le(31),s=0;s<31;++s)i[s]=t+=1<<a[s-1];for(var u=new Er(i[30]),s=1;s<30;++s)for(var d=i[s];d<i[s+1];++d)u[d]=d-i[s]<<5|s;return[i,u]},tt=rt(Qr,2),nt=tt[0],wn=tt[1];nt[28]=258,wn[258]=28;var _n=rt(et,0),En=_n[0],yr=new Le(32768);for(var ae=0;ae<32768;++ae){var Ne=(ae&43690)>>>1|(ae&21845)<<1;Ne=(Ne&52428)>>>2|(Ne&13107)<<2,Ne=(Ne&61680)>>>4|(Ne&3855)<<4,yr[ae]=((Ne&65280)>>>8|(Ne&255)<<8)>>>1}var er=function(a,t,i){for(var s=a.length,u=0,d=new Le(t);u<s;++u)++d[a[u]-1];var h=new Le(t);for(u=0;u<t;++u)h[u]=h[u-1]+d[u-1]<<1;var f;if(i){f=new Le(1<<t);var g=15-t;for(u=0;u<s;++u)if(a[u])for(var y=u<<4|a[u],M=t-a[u],T=h[a[u]-1]++<<M,b=T|(1<<M)-1;T<=b;++T)f[yr[T]>>>g]=y}else for(f=new Le(s),u=0;u<s;++u)a[u]&&(f[u]=yr[h[a[u]-1]++]>>>15-a[u]);return f},ar=new Se(288);for(var ae=0;ae<144;++ae)ar[ae]=8;for(var ae=144;ae<256;++ae)ar[ae]=9;for(var ae=256;ae<280;++ae)ar[ae]=7;for(var ae=280;ae<288;++ae)ar[ae]=8;var at=new Se(32);for(var ae=0;ae<32;++ae)at[ae]=5;var yn=er(ar,9,1),Sn=er(at,5,1),pr=function(a){for(var t=a[0],i=1;i<a.length;++i)a[i]>t&&(t=a[i]);return t},be=function(a,t,i){var s=t/8|0;return(a[s]|a[s+1]<<8)>>(t&7)&i},gr=function(a,t){var i=t/8|0;return(a[i]|a[i+1]<<8|a[i+2]<<16)>>(t&7)},Mn=function(a){return(a/8|0)+(a&7&&1)},In=function(a,t,i){(i==null||i>a.length)&&(i=a.length);var s=new(a instanceof Le?Le:a instanceof Er?Er:Se)(i-t);return s.set(a.subarray(t,i)),s},xn=function(a,t,i){var s=a.length;if(!s||i&&!i.l&&s<5)return t||new Se(0);var u=!t||i,d=!i||i.i;i||(i={}),t||(t=new Se(s*3));var h=function(V){var Ae=t.length;if(V>Ae){var Fe=new Se(Math.max(Ae*2,V));Fe.set(t),t=Fe}},f=i.f||0,g=i.p||0,y=i.b||0,M=i.l,T=i.d,b=i.m,F=i.n,W=s*8;do{if(!M){i.f=f=be(a,g,1);var J=be(a,g+1,3);if(g+=3,J)if(J==1)M=yn,T=Sn,b=9,F=5;else if(J==2){var re=be(a,g,31)+257,j=be(a,g+10,15)+4,L=re+be(a,g+5,31)+1;g+=14;for(var B=new Se(L),Y=new Se(19),S=0;S<j;++S)Y[mn[S]]=be(a,g+S*3,7);g+=j*3;for(var I=pr(Y),G=(1<<I)-1,Z=er(Y,I,1),S=0;S<L;){var P=Z[be(a,g,G)];g+=P&15;var k=P>>>4;if(k<16)B[S++]=k;else{var X=0,A=0;for(k==16?(A=3+be(a,g,3),g+=2,X=B[S-1]):k==17?(A=3+be(a,g,7),g+=3):k==18&&(A=11+be(a,g,127),g+=7);A--;)B[S++]=X}}var ie=B.subarray(0,re),N=B.subarray(re);b=pr(ie),F=pr(N),M=er(ie,b,1),T=er(N,F,1)}else throw"invalid block type";else{var k=Mn(g)+4,O=a[k-4]|a[k-3]<<8,ce=k+O;if(ce>s){if(d)throw"unexpected EOF";break}u&&h(y+O),t.set(a.subarray(k,ce),y),i.b=y+=O,i.p=g=ce*8;continue}if(g>W){if(d)throw"unexpected EOF";break}}u&&h(y+131072);for(var Ie=(1<<b)-1,Pe=(1<<F)-1,xe=g;;xe=g){var X=M[gr(a,g)&Ie],te=X>>>4;if(g+=X&15,g>W){if(d)throw"unexpected EOF";break}if(!X)throw"invalid length/literal";if(te<256)t[y++]=te;else if(te==256){xe=g,M=null;break}else{var De=te-254;if(te>264){var S=te-257,oe=Qr[S];De=be(a,g,(1<<oe)-1)+nt[S],g+=oe}var ve=T[gr(a,g)&Pe],Te=ve>>>4;if(!ve)throw"invalid distance";g+=ve&15;var N=En[Te];if(Te>3){var oe=et[Te];N+=gr(a,g)&(1<<oe)-1,g+=oe}if(g>W){if(d)throw"unexpected EOF";break}u&&h(y+131072);for(var je=y+De;y<je;y+=4)t[y]=t[y-N],t[y+1]=t[y+1-N],t[y+2]=t[y+2-N],t[y+3]=t[y+3-N];y=je}}i.l=M,i.p=xe,i.b=y,M&&(f=1,i.m=b,i.d=T,i.n=F)}while(!f);return y==t.length?t:In(t,0,y)},bn=new Se(0),Tn=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function sr(a,t){return xn((Tn(a),a.subarray(2,-4)),t)}var Cn=typeof TextDecoder<"u"&&new TextDecoder,Rn=0;try{Cn.decode(bn,{stream:!0}),Rn=1}catch{}const An=a=>a&&a.isCubeTexture;class Fn extends Sr{constructor(t,i){var s,u;const d=An(t),f=((u=d?(s=t.image[0])==null?void 0:s.width:t.image.width)!=null?u:1024)/4,g=Math.floor(Math.log2(f)),y=Math.pow(2,g),M=3*Math.max(y,16*7),T=4*y,b=[d?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/M}`,`#define CUBEUV_TEXEL_HEIGHT ${1/T}`,`#define CUBEUV_MAX_MIP ${g}.0`],F=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,W=b.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(Wt.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,J={map:{value:t},height:{value:(i==null?void 0:i.height)||15},radius:{value:(i==null?void 0:i.radius)||100}},k=new Zt(1,16),O=new Mr({uniforms:J,fragmentShader:W,vertexShader:F,side:Xr});super(k,O)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}class Un extends jr{constructor(t){super(t),this.type=Me}parse(t){const h=function(S,I){switch(S){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(I||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(I||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(I||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(I||""))}},M=`
`,T=function(S,I,G){I=I||1024;let P=S.pos,X=-1,A=0,ie="",N=String.fromCharCode.apply(null,new Uint16Array(S.subarray(P,P+128)));for(;0>(X=N.indexOf(M))&&A<I&&P<S.byteLength;)ie+=N,A+=N.length,P+=128,N+=String.fromCharCode.apply(null,new Uint16Array(S.subarray(P,P+128)));return-1<X?(S.pos+=A+X+1,ie+N.slice(0,X)):!1},b=function(S){const I=/^#\?(\S+)/,G=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,P=/^\s*FORMAT=(\S+)\s*$/,X=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,A={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let ie,N;for((S.pos>=S.byteLength||!(ie=T(S)))&&h(1,"no header found"),(N=ie.match(I))||h(3,"bad initial token"),A.valid|=1,A.programtype=N[1],A.string+=ie+`
`;ie=T(S),ie!==!1;){if(A.string+=ie+`
`,ie.charAt(0)==="#"){A.comments+=ie+`
`;continue}if((N=ie.match(G))&&(A.gamma=parseFloat(N[1])),(N=ie.match(Z))&&(A.exposure=parseFloat(N[1])),(N=ie.match(P))&&(A.valid|=2,A.format=N[1]),(N=ie.match(X))&&(A.valid|=4,A.height=parseInt(N[1],10),A.width=parseInt(N[2],10)),A.valid&2&&A.valid&4)break}return A.valid&2||h(3,"missing format specifier"),A.valid&4||h(3,"missing image size specifier"),A},F=function(S,I,G){const Z=I;if(Z<8||Z>32767||S[0]!==2||S[1]!==2||S[2]&128)return new Uint8Array(S);Z!==(S[2]<<8|S[3])&&h(3,"wrong scanline width");const P=new Uint8Array(4*I*G);P.length||h(4,"unable to allocate buffer space");let X=0,A=0;const ie=4*Z,N=new Uint8Array(4),Ie=new Uint8Array(ie);let Pe=G;for(;Pe>0&&A<S.byteLength;){A+4>S.byteLength&&h(1),N[0]=S[A++],N[1]=S[A++],N[2]=S[A++],N[3]=S[A++],(N[0]!=2||N[1]!=2||(N[2]<<8|N[3])!=Z)&&h(3,"bad rgbe scanline format");let xe=0,te;for(;xe<ie&&A<S.byteLength;){te=S[A++];const oe=te>128;if(oe&&(te-=128),(te===0||xe+te>ie)&&h(3,"bad scanline data"),oe){const ve=S[A++];for(let Te=0;Te<te;Te++)Ie[xe++]=ve}else Ie.set(S.subarray(A,A+te),xe),xe+=te,A+=te}const De=Z;for(let oe=0;oe<De;oe++){let ve=0;P[X]=Ie[oe+ve],ve+=Z,P[X+1]=Ie[oe+ve],ve+=Z,P[X+2]=Ie[oe+ve],ve+=Z,P[X+3]=Ie[oe+ve],X+=4}Pe--}return P},W=function(S,I,G,Z){const P=S[I+3],X=Math.pow(2,P-128)/255;G[Z+0]=S[I+0]*X,G[Z+1]=S[I+1]*X,G[Z+2]=S[I+2]*X,G[Z+3]=1},J=function(S,I,G,Z){const P=S[I+3],X=Math.pow(2,P-128)/255;G[Z+0]=We.toHalfFloat(Math.min(S[I+0]*X,65504)),G[Z+1]=We.toHalfFloat(Math.min(S[I+1]*X,65504)),G[Z+2]=We.toHalfFloat(Math.min(S[I+2]*X,65504)),G[Z+3]=We.toHalfFloat(1)},k=new Uint8Array(t);k.pos=0;const O=b(k),ce=O.width,re=O.height,j=F(k.subarray(k.pos),ce,re);let L,B,Y;switch(this.type){case Oe:Y=j.length/4;const S=new Float32Array(Y*4);for(let G=0;G<Y;G++)W(j,G*4,S,G*4);L=S,B=Oe;break;case Me:Y=j.length/4;const I=new Uint16Array(Y*4);for(let G=0;G<Y;G++)J(j,G*4,I,G*4);L=I,B=Me;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:ce,height:re,data:L,header:O.string,gamma:O.gamma,exposure:O.exposure,type:B}}setDataType(t){return this.type=t,this}load(t,i,s,u){function d(h,f){switch(h.type){case Oe:case Me:"colorSpace"in h?h.colorSpace="srgb-linear":h.encoding=3e3,h.minFilter=Re,h.magFilter=Re,h.generateMipmaps=!1,h.flipY=!0;break}i&&i(h,f)}return super.load(t,d,s,u)}}const Je="colorSpace"in new ze;class On extends jr{constructor(t){super(t),this.type=Me}parse(t){const I=Math.pow(2.7182818,2.2);function G(e,r){for(var n=0,o=0;o<65536;++o)(o==0||e[o>>3]&1<<(o&7))&&(r[n++]=o);for(var l=n-1;n<65536;)r[n++]=0;return l}function Z(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const P={l:0,c:0,lc:0};function X(e,r,n,o,l){for(;n<e;)r=r<<8|kr(o,l),n+=8;n-=e,P.l=r>>n&(1<<e)-1,P.c=r,P.lc=n}const A=new Array(59);function ie(e){for(var r=0;r<=58;++r)A[r]=0;for(var r=0;r<65537;++r)A[e[r]]+=1;for(var n=0,r=58;r>0;--r){var o=n+A[r]>>1;A[r]=n,n=o}for(var r=0;r<65537;++r){var l=e[r];l>0&&(e[r]=l|A[l]++<<6)}}function N(e,r,n,o,l,c,p){for(var v=n,_=0,w=0;l<=c;l++){if(v.value-n.value>o)return!1;X(6,_,w,e,v);var E=P.l;if(_=P.c,w=P.lc,p[l]=E,E==63){if(v.value-n.value>o)throw"Something wrong with hufUnpackEncTable";X(8,_,w,e,v);var m=P.l+6;if(_=P.c,w=P.lc,l+m>c+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)p[l++]=0;l--}else if(E>=59){var m=E-59+2;if(l+m>c+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)p[l++]=0;l--}}ie(p)}function Ie(e){return e&63}function Pe(e){return e>>6}function xe(e,r,n,o){for(;r<=n;r++){var l=Pe(e[r]),c=Ie(e[r]);if(l>>c)throw"Invalid table entry";if(c>14){var p=o[l>>c-14];if(p.len)throw"Invalid table entry";if(p.lit++,p.p){var v=p.p;p.p=new Array(p.lit);for(var _=0;_<p.lit-1;++_)p.p[_]=v[_]}else p.p=new Array(1);p.p[p.lit-1]=r}else if(c)for(var w=0,_=1<<14-c;_>0;_--){var p=o[(l<<14-c)+w];if(p.len||p.p)throw"Invalid table entry";p.len=c,p.lit=r,w++}}return!0}const te={c:0,lc:0};function De(e,r,n,o){e=e<<8|kr(n,o),r+=8,te.c=e,te.lc=r}const oe={c:0,lc:0};function ve(e,r,n,o,l,c,p,v,_,w){if(e==r){o<8&&(De(n,o,l,p),n=te.c,o=te.lc),o-=8;var E=n>>o,E=new Uint8Array([E])[0];if(_.value+E>w)return!1;for(var m=v[_.value-1];E-- >0;)v[_.value++]=m}else if(_.value<w)v[_.value++]=e;else return!1;oe.c=n,oe.lc=o}function Te(e){return e&65535}function je(e){var r=Te(e);return r>32767?r-65536:r}const V={a:0,b:0};function Ae(e,r){var n=je(e),o=je(r),l=o,c=n+(l&1)+(l>>1),p=c,v=c-l;V.a=p,V.b=v}function Fe(e,r){var n=Te(e),o=Te(r),l=n-(o>>1)&65535,c=o+l-32768&65535;V.a=c,V.b=l}function dt(e,r,n,o,l,c,p){for(var v=p<16384,_=n>l?l:n,w=1,E;w<=_;)w<<=1;for(w>>=1,E=w,w>>=1;w>=1;){for(var m=0,le=m+c*(l-E),C=c*w,R=c*E,U=o*w,D=o*E,q,Q,ue,fe;m<=le;m+=R){for(var ee=m,Ce=m+o*(n-E);ee<=Ce;ee+=D){var ne=ee+U,he=ee+C,Ue=he+U;v?(Ae(e[ee+r],e[he+r]),q=V.a,ue=V.b,Ae(e[ne+r],e[Ue+r]),Q=V.a,fe=V.b,Ae(q,Q),e[ee+r]=V.a,e[ne+r]=V.b,Ae(ue,fe),e[he+r]=V.a,e[Ue+r]=V.b):(Fe(e[ee+r],e[he+r]),q=V.a,ue=V.b,Fe(e[ne+r],e[Ue+r]),Q=V.a,fe=V.b,Fe(q,Q),e[ee+r]=V.a,e[ne+r]=V.b,Fe(ue,fe),e[he+r]=V.a,e[Ue+r]=V.b)}if(n&w){var he=ee+C;v?Ae(e[ee+r],e[he+r]):Fe(e[ee+r],e[he+r]),q=V.a,e[he+r]=V.b,e[ee+r]=q}}if(l&w)for(var ee=m,Ce=m+o*(n-E);ee<=Ce;ee+=D){var ne=ee+U;v?Ae(e[ee+r],e[ne+r]):Fe(e[ee+r],e[ne+r]),q=V.a,e[ne+r]=V.b,e[ee+r]=q}E=w,w>>=1}return m}function vt(e,r,n,o,l,c,p,v,_,w){for(var E=0,m=0,le=v,C=Math.trunc(l.value+(c+7)/8);l.value<C;)for(De(E,m,n,l),E=te.c,m=te.lc;m>=14;){var R=E>>m-14&16383,U=r[R];if(U.len)m-=U.len,ve(U.lit,p,E,m,n,o,l,_,w,le),E=oe.c,m=oe.lc;else{if(!U.p)throw"hufDecode issues";var D;for(D=0;D<U.lit;D++){for(var q=Ie(e[U.p[D]]);m<q&&l.value<C;)De(E,m,n,l),E=te.c,m=te.lc;if(m>=q&&Pe(e[U.p[D]])==(E>>m-q&(1<<q)-1)){m-=q,ve(U.p[D],p,E,m,n,o,l,_,w,le),E=oe.c,m=oe.lc;break}}if(D==U.lit)throw"hufDecode issues"}}var Q=8-c&7;for(E>>=Q,m-=Q;m>0;){var U=r[E<<14-m&16383];if(U.len)m-=U.len,ve(U.lit,p,E,m,n,o,l,_,w,le),E=oe.c,m=oe.lc;else throw"hufDecode issues"}return!0}function Fr(e,r,n,o,l,c){var p={value:0},v=n.value,_=me(r,n),w=me(r,n);n.value+=4;var E=me(r,n);if(n.value+=4,_<0||_>=65537||w<0||w>=65537)throw"Something wrong with HUF_ENCSIZE";var m=new Array(65537),le=new Array(16384);Z(le);var C=o-(n.value-v);if(N(e,r,n,C,_,w,m),E>8*(o-(n.value-v)))throw"Something wrong with hufUncompress";xe(m,_,w,le),vt(m,le,e,r,n,E,w,c,l,p)}function pt(e,r,n){for(var o=0;o<n;++o)r[o]=e[r[o]]}function Ur(e){for(var r=1;r<e.length;r++){var n=e[r-1]+e[r]-128;e[r]=n}}function Or(e,r){for(var n=0,o=Math.floor((e.length+1)/2),l=0,c=e.length-1;!(l>c||(r[l++]=e[n++],l>c));)r[l++]=e[o++]}function Dr(e){for(var r=e.byteLength,n=new Array,o=0,l=new DataView(e);r>0;){var c=l.getInt8(o++);if(c<0){var p=-c;r-=p+1;for(var v=0;v<p;v++)n.push(l.getUint8(o++))}else{var p=c;r-=2;for(var _=l.getUint8(o++),v=0;v<p+1;v++)n.push(_)}}return n}function gt(e,r,n,o,l,c){var ne=new DataView(c.buffer),p=n[e.idx[0]].width,v=n[e.idx[0]].height,_=3,w=Math.floor(p/8),E=Math.ceil(p/8),m=Math.ceil(v/8),le=p-(E-1)*8,C=v-(m-1)*8,R={value:0},U=new Array(_),D=new Array(_),q=new Array(_),Q=new Array(_),ue=new Array(_);for(let K=0;K<_;++K)ue[K]=r[e.idx[K]],U[K]=K<1?0:U[K-1]+E*m,D[K]=new Float32Array(64),q[K]=new Uint16Array(64),Q[K]=new Uint16Array(E*64);for(let K=0;K<m;++K){var fe=8;K==m-1&&(fe=C);var ee=8;for(let se=0;se<E;++se){se==E-1&&(ee=le);for(let $=0;$<_;++$)q[$].fill(0),q[$][0]=l[U[$]++],ft(R,o,q[$]),mt(q[$],D[$]),wt(D[$]);_t(D);for(let $=0;$<_;++$)Et(D[$],Q[$],se*64)}let ge=0;for(let se=0;se<_;++se){const $=n[e.idx[se]].type;for(let ye=8*K;ye<8*K+fe;++ye){ge=ue[se][ye];for(let He=0;He<w;++He){const we=He*64+(ye&7)*8;ne.setUint16(ge+0*2*$,Q[se][we+0],!0),ne.setUint16(ge+1*2*$,Q[se][we+1],!0),ne.setUint16(ge+2*2*$,Q[se][we+2],!0),ne.setUint16(ge+3*2*$,Q[se][we+3],!0),ne.setUint16(ge+4*2*$,Q[se][we+4],!0),ne.setUint16(ge+5*2*$,Q[se][we+5],!0),ne.setUint16(ge+6*2*$,Q[se][we+6],!0),ne.setUint16(ge+7*2*$,Q[se][we+7],!0),ge+=8*2*$}}if(w!=E)for(let ye=8*K;ye<8*K+fe;++ye){const He=ue[se][ye]+8*w*2*$,we=w*64+(ye&7)*8;for(let Be=0;Be<ee;++Be)ne.setUint16(He+Be*2*$,Q[se][we+Be],!0)}}}for(var Ce=new Uint16Array(p),ne=new DataView(c.buffer),he=0;he<_;++he){n[e.idx[he]].decoded=!0;var Ue=n[e.idx[he]].type;if(n[he].type==2)for(var Ke=0;Ke<v;++Ke){const K=ue[he][Ke];for(var Ee=0;Ee<p;++Ee)Ce[Ee]=ne.getUint16(K+Ee*2*Ue,!0);for(var Ee=0;Ee<p;++Ee)ne.setFloat32(K+Ee*2*Ue,x(Ce[Ee]),!0)}}}function ft(e,r,n){for(var o,l=1;l<64;)o=r[e.value],o==65280?l=64:o>>8==255?l+=o&255:(n[l]=o,l++),e.value++}function mt(e,r){r[0]=x(e[0]),r[1]=x(e[1]),r[2]=x(e[5]),r[3]=x(e[6]),r[4]=x(e[14]),r[5]=x(e[15]),r[6]=x(e[27]),r[7]=x(e[28]),r[8]=x(e[2]),r[9]=x(e[4]),r[10]=x(e[7]),r[11]=x(e[13]),r[12]=x(e[16]),r[13]=x(e[26]),r[14]=x(e[29]),r[15]=x(e[42]),r[16]=x(e[3]),r[17]=x(e[8]),r[18]=x(e[12]),r[19]=x(e[17]),r[20]=x(e[25]),r[21]=x(e[30]),r[22]=x(e[41]),r[23]=x(e[43]),r[24]=x(e[9]),r[25]=x(e[11]),r[26]=x(e[18]),r[27]=x(e[24]),r[28]=x(e[31]),r[29]=x(e[40]),r[30]=x(e[44]),r[31]=x(e[53]),r[32]=x(e[10]),r[33]=x(e[19]),r[34]=x(e[23]),r[35]=x(e[32]),r[36]=x(e[39]),r[37]=x(e[45]),r[38]=x(e[52]),r[39]=x(e[54]),r[40]=x(e[20]),r[41]=x(e[22]),r[42]=x(e[33]),r[43]=x(e[38]),r[44]=x(e[46]),r[45]=x(e[51]),r[46]=x(e[55]),r[47]=x(e[60]),r[48]=x(e[21]),r[49]=x(e[34]),r[50]=x(e[37]),r[51]=x(e[47]),r[52]=x(e[50]),r[53]=x(e[56]),r[54]=x(e[59]),r[55]=x(e[61]),r[56]=x(e[35]),r[57]=x(e[36]),r[58]=x(e[48]),r[59]=x(e[49]),r[60]=x(e[57]),r[61]=x(e[58]),r[62]=x(e[62]),r[63]=x(e[63])}function wt(e){const r=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),l=.5*Math.cos(3*3.14159/16),c=.5*Math.cos(5*3.14159/16),p=.5*Math.cos(3*3.14159/8),v=.5*Math.cos(7*3.14159/16);for(var _=new Array(4),w=new Array(4),E=new Array(4),m=new Array(4),le=0;le<8;++le){var C=le*8;_[0]=o*e[C+2],_[1]=p*e[C+2],_[2]=o*e[C+6],_[3]=p*e[C+6],w[0]=n*e[C+1]+l*e[C+3]+c*e[C+5]+v*e[C+7],w[1]=l*e[C+1]-v*e[C+3]-n*e[C+5]-c*e[C+7],w[2]=c*e[C+1]-n*e[C+3]+v*e[C+5]+l*e[C+7],w[3]=v*e[C+1]-c*e[C+3]+l*e[C+5]-n*e[C+7],E[0]=r*(e[C+0]+e[C+4]),E[3]=r*(e[C+0]-e[C+4]),E[1]=_[0]+_[3],E[2]=_[1]-_[2],m[0]=E[0]+E[1],m[1]=E[3]+E[2],m[2]=E[3]-E[2],m[3]=E[0]-E[1],e[C+0]=m[0]+w[0],e[C+1]=m[1]+w[1],e[C+2]=m[2]+w[2],e[C+3]=m[3]+w[3],e[C+4]=m[3]-w[3],e[C+5]=m[2]-w[2],e[C+6]=m[1]-w[1],e[C+7]=m[0]-w[0]}for(var R=0;R<8;++R)_[0]=o*e[16+R],_[1]=p*e[16+R],_[2]=o*e[48+R],_[3]=p*e[48+R],w[0]=n*e[8+R]+l*e[24+R]+c*e[40+R]+v*e[56+R],w[1]=l*e[8+R]-v*e[24+R]-n*e[40+R]-c*e[56+R],w[2]=c*e[8+R]-n*e[24+R]+v*e[40+R]+l*e[56+R],w[3]=v*e[8+R]-c*e[24+R]+l*e[40+R]-n*e[56+R],E[0]=r*(e[R]+e[32+R]),E[3]=r*(e[R]-e[32+R]),E[1]=_[0]+_[3],E[2]=_[1]-_[2],m[0]=E[0]+E[1],m[1]=E[3]+E[2],m[2]=E[3]-E[2],m[3]=E[0]-E[1],e[0+R]=m[0]+w[0],e[8+R]=m[1]+w[1],e[16+R]=m[2]+w[2],e[24+R]=m[3]+w[3],e[32+R]=m[3]-w[3],e[40+R]=m[2]-w[2],e[48+R]=m[1]-w[1],e[56+R]=m[0]-w[0]}function _t(e){for(var r=0;r<64;++r){var n=e[0][r],o=e[1][r],l=e[2][r];e[0][r]=n+1.5747*l,e[1][r]=n-.1873*o-.4682*l,e[2][r]=n+1.8556*o}}function Et(e,r,n){for(var o=0;o<64;++o)r[n+o]=We.toHalfFloat(yt(e[o]))}function yt(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(I,Math.abs(e)-1)}function Br(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function St(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(Dr(r)),o=new Uint8Array(n.length);return Ur(n),Or(n,o),new DataView(o.buffer)}function vr(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=sr(r),o=new Uint8Array(n.length);return Ur(n),Or(n,o),new DataView(o.buffer)}function Mt(e){for(var r=e.viewer,n={value:e.offset.value},o=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),l=new Uint8Array(8192),c=0,p=new Array(e.channels),v=0;v<e.channels;v++)p[v]={},p[v].start=c,p[v].end=p[v].start,p[v].nx=e.width,p[v].ny=e.lines,p[v].size=e.type,c+=p[v].nx*p[v].ny*p[v].size;var _=Ye(r,n),w=Ye(r,n);if(w>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(_<=w)for(var v=0;v<w-_+1;v++)l[v+_]=Ge(r,n);var E=new Uint16Array(65536),m=G(l,E),le=me(r,n);Fr(e.array,r,n,le,o,c);for(var v=0;v<e.channels;++v)for(var C=p[v],R=0;R<p[v].size;++R)dt(o,C.start+R,C.nx,C.size,C.ny,C.nx*C.size,m);pt(E,o,c);for(var U=0,D=new Uint8Array(o.buffer.byteLength),q=0;q<e.lines;q++)for(var Q=0;Q<e.channels;Q++){var C=p[Q],ue=C.nx*C.size,fe=new Uint8Array(o.buffer,C.end*2,ue*2);D.set(fe,U),U+=ue*2,C.end+=ue}return new DataView(D.buffer)}function It(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=sr(r);const o=e.lines*e.channels*e.width,l=e.type==1?new Uint16Array(o):new Uint32Array(o);let c=0,p=0;const v=new Array(4);for(let _=0;_<e.lines;_++)for(let w=0;w<e.channels;w++){let E=0;switch(e.type){case 1:v[0]=c,v[1]=v[0]+e.width,c=v[1]+e.width;for(let m=0;m<e.width;++m){const le=n[v[0]++]<<8|n[v[1]++];E+=le,l[p]=E,p++}break;case 2:v[0]=c,v[1]=v[0]+e.width,v[2]=v[1]+e.width,c=v[2]+e.width;for(let m=0;m<e.width;++m){const le=n[v[0]++]<<24|n[v[1]++]<<16|n[v[2]++]<<8;E+=le,l[p]=E,p++}break}}return new DataView(l.buffer)}function Nr(e){var r=e.viewer,n={value:e.offset.value},o=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),l={version:_e(r,n),unknownUncompressedSize:_e(r,n),unknownCompressedSize:_e(r,n),acCompressedSize:_e(r,n),dcCompressedSize:_e(r,n),rleCompressedSize:_e(r,n),rleUncompressedSize:_e(r,n),rleRawSize:_e(r,n),totalAcUncompressedCount:_e(r,n),totalDcUncompressedCount:_e(r,n),acCompression:_e(r,n)};if(l.version<2)throw"EXRLoader.parse: "+qe.compression+" version "+l.version+" is unsupported";for(var c=new Array,p=Ye(r,n)-2;p>0;){var v=ir(r.buffer,n),_=Ge(r,n),w=_>>2&3,E=(_>>4)-1,m=new Int8Array([E])[0],le=Ge(r,n);c.push({name:v,index:m,type:le,compression:w}),p-=v.length+3}for(var C=qe.channels,R=new Array(e.channels),U=0;U<e.channels;++U){var D=R[U]={},q=C[U];D.name=q.name,D.compression=0,D.decoded=!1,D.type=q.pixelType,D.pLinear=q.pLinear,D.width=e.width,D.height=e.lines}for(var Q={idx:new Array(3)},ue=0;ue<e.channels;++ue)for(var D=R[ue],U=0;U<c.length;++U){var fe=c[U];D.name==fe.name&&(D.compression=fe.compression,fe.index>=0&&(Q.idx[fe.index]=ue),D.offset=ue)}if(l.acCompressedSize>0)switch(l.acCompression){case 0:var ne=new Uint16Array(l.totalAcUncompressedCount);Fr(e.array,r,n,l.acCompressedSize,ne,l.totalAcUncompressedCount);break;case 1:var ee=e.array.slice(n.value,n.value+l.totalAcUncompressedCount),Ce=sr(ee),ne=new Uint16Array(Ce.buffer);n.value+=l.totalAcUncompressedCount;break}if(l.dcCompressedSize>0){var he={array:e.array,offset:n,size:l.dcCompressedSize},Ue=new Uint16Array(vr(he).buffer);n.value+=l.dcCompressedSize}if(l.rleRawSize>0){var ee=e.array.slice(n.value,n.value+l.rleCompressedSize),Ce=sr(ee),Ke=Dr(Ce.buffer);n.value+=l.rleCompressedSize}for(var Ee=0,K=new Array(R.length),U=0;U<K.length;++U)K[U]=new Array;for(var ge=0;ge<e.lines;++ge)for(var se=0;se<R.length;++se)K[se].push(Ee),Ee+=R[se].width*e.type*2;gt(Q,K,R,ne,Ue,o);for(var U=0;U<R.length;++U){var D=R[U];if(!D.decoded)switch(D.compression){case 2:for(var $=0,ye=0,ge=0;ge<e.lines;++ge){for(var He=K[U][$],we=0;we<D.width;++we){for(var Be=0;Be<2*D.type;++Be)o[He++]=Ke[ye+Be*D.width*D.height];ye++}$++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(o.buffer)}function ir(e,r){for(var n=new Uint8Array(e),o=0;n[r.value+o]!=0;)o+=1;var l=new TextDecoder().decode(n.slice(r.value,r.value+o));return r.value=r.value+o+1,l}function xt(e,r,n){var o=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+n));return r.value=r.value+n,o}function bt(e,r){var n=$e(e,r),o=me(e,r);return[n,o]}function Tt(e,r){var n=me(e,r),o=me(e,r);return[n,o]}function $e(e,r){var n=e.getInt32(r.value,!0);return r.value=r.value+4,n}function me(e,r){var n=e.getUint32(r.value,!0);return r.value=r.value+4,n}function kr(e,r){var n=e[r.value];return r.value=r.value+1,n}function Ge(e,r){var n=e.getUint8(r.value);return r.value=r.value+1,n}const _e=function(e,r){let n;return"getBigInt64"in DataView.prototype?n=Number(e.getBigInt64(r.value,!0)):n=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,n};function pe(e,r){var n=e.getFloat32(r.value,!0);return r.value+=4,n}function Ct(e,r){return We.toHalfFloat(pe(e,r))}function x(e){var r=(e&31744)>>10,n=e&1023;return(e>>15?-1:1)*(r?r===31?n?NaN:1/0:Math.pow(2,r-15)*(1+n/1024):6103515625e-14*(n/1024))}function Ye(e,r){var n=e.getUint16(r.value,!0);return r.value+=2,n}function Rt(e,r){return x(Ye(e,r))}function At(e,r,n,o){for(var l=n.value,c=[];n.value<l+o-1;){var p=ir(r,n),v=$e(e,n),_=Ge(e,n);n.value+=3;var w=$e(e,n),E=$e(e,n);c.push({name:p,pixelType:v,pLinear:_,xSampling:w,ySampling:E})}return n.value+=1,c}function Ft(e,r){var n=pe(e,r),o=pe(e,r),l=pe(e,r),c=pe(e,r),p=pe(e,r),v=pe(e,r),_=pe(e,r),w=pe(e,r);return{redX:n,redY:o,greenX:l,greenY:c,blueX:p,blueY:v,whiteX:_,whiteY:w}}function Ut(e,r){var n=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],o=Ge(e,r);return n[o]}function Ot(e,r){var n=me(e,r),o=me(e,r),l=me(e,r),c=me(e,r);return{xMin:n,yMin:o,xMax:l,yMax:c}}function Dt(e,r){var n=["INCREASING_Y"],o=Ge(e,r);return n[o]}function Bt(e,r){var n=pe(e,r),o=pe(e,r);return[n,o]}function Nt(e,r){var n=pe(e,r),o=pe(e,r),l=pe(e,r);return[n,o,l]}function kt(e,r,n,o,l){if(o==="string"||o==="stringvector"||o==="iccProfile")return xt(r,n,l);if(o==="chlist")return At(e,r,n,l);if(o==="chromaticities")return Ft(e,n);if(o==="compression")return Ut(e,n);if(o==="box2i")return Ot(e,n);if(o==="lineOrder")return Dt(e,n);if(o==="float")return pe(e,n);if(o==="v2f")return Bt(e,n);if(o==="v3f")return Nt(e,n);if(o==="int")return $e(e,n);if(o==="rational")return bt(e,n);if(o==="timecode")return Tt(e,n);if(o==="preview")return n.value+=l,"skipped";n.value+=l}function Lt(e,r,n){const o={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";o.version=e.getUint8(4);const l=e.getUint8(5);o.spec={singleTile:!!(l&2),longName:!!(l&4),deepFormat:!!(l&8),multiPart:!!(l&16)},n.value=8;for(var c=!0;c;){var p=ir(r,n);if(p==0)c=!1;else{var v=ir(r,n),_=me(e,n),w=kt(e,r,n,v,_);w===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${v}'.`):o[p]=w}}if(l&-5)throw console.error("EXRHeader:",o),"THREE.EXRLoader: provided file is currently unsupported.";return o}function Pt(e,r,n,o,l){const c={size:0,viewer:r,array:n,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Je?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":c.lines=1,c.uncompress=Br;break;case"RLE_COMPRESSION":c.lines=1,c.uncompress=St;break;case"ZIPS_COMPRESSION":c.lines=1,c.uncompress=vr;break;case"ZIP_COMPRESSION":c.lines=16,c.uncompress=vr;break;case"PIZ_COMPRESSION":c.lines=32,c.uncompress=Mt;break;case"PXR24_COMPRESSION":c.lines=16,c.uncompress=It;break;case"DWAA_COMPRESSION":c.lines=32,c.uncompress=Nr;break;case"DWAB_COMPRESSION":c.lines=256,c.uncompress=Nr;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(c.scanlineBlockSize=c.lines,c.type==1)switch(l){case Oe:c.getter=Rt,c.inputSize=2;break;case Me:c.getter=Ye,c.inputSize=2;break}else if(c.type==2)switch(l){case Oe:c.getter=pe,c.inputSize=4;break;case Me:c.getter=Ct,c.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+c.type+" for "+e.compression+".";c.blockCount=(e.dataWindow.yMax+1)/c.scanlineBlockSize;for(var p=0;p<c.blockCount;p++)_e(r,o);c.outputChannels=c.channels==3?4:c.channels;const v=c.width*c.height*c.outputChannels;switch(l){case Oe:c.byteArray=new Float32Array(v),c.channels<c.outputChannels&&c.byteArray.fill(1,0,v);break;case Me:c.byteArray=new Uint16Array(v),c.channels<c.outputChannels&&c.byteArray.fill(15360,0,v);break;default:console.error("THREE.EXRLoader: unsupported type: ",l);break}return c.bytesPerLine=c.width*c.inputSize*c.channels,c.outputChannels==4?c.format=rr:c.format=Xt,Je?c.colorSpace="srgb-linear":c.encoding=3e3,c}const or=new DataView(t),Ht=new Uint8Array(t),Ve={value:0},qe=Lt(or,t,Ve),H=Pt(qe,or,Ht,Ve,this.type),Lr={value:0},zt={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<H.height/H.scanlineBlockSize;e++){const r=me(or,Ve);H.size=me(or,Ve),H.lines=r+H.scanlineBlockSize>H.height?H.height-r:H.scanlineBlockSize;const o=H.size<H.lines*H.bytesPerLine?H.uncompress(H):Br(H);Ve.value+=H.size;for(let l=0;l<H.scanlineBlockSize;l++){const c=l+e*H.scanlineBlockSize;if(c>=H.height)break;for(let p=0;p<H.channels;p++){const v=zt[qe.channels[p].name];for(let _=0;_<H.width;_++){Lr.value=(l*(H.channels*H.width)+p*H.width+_)*H.inputSize;const w=(H.height-1-c)*(H.width*H.outputChannels)+_*H.outputChannels+v;H.byteArray[w]=H.getter(o,Lr)}}}}return{header:qe,width:H.width,height:H.height,data:H.byteArray,format:H.format,[Je?"colorSpace":"encoding"]:H[Je?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,i,s,u){function d(h,f){Je?h.colorSpace=f.colorSpace:h.encoding=f.encoding,h.minFilter=Re,h.magFilter=Re,h.generateMipmaps=!1,h.flipY=!1,i&&i(h,f)}return super.load(t,d,s,u)}}const Dn=z.forwardRef(function({children:t,disable:i,disableX:s,disableY:u,disableZ:d,left:h,right:f,top:g,bottom:y,front:M,back:T,onCentered:b,precise:F=!0,cacheKey:W=0,...J},k){const O=z.useRef(null),ce=z.useRef(null),re=z.useRef(null);return z.useLayoutEffect(()=>{ce.current.matrixWorld.identity();const j=new jt().setFromObject(re.current,F),L=new Ze,B=new $t,Y=j.max.x-j.min.x,S=j.max.y-j.min.y,I=j.max.z-j.min.z;j.getCenter(L),j.getBoundingSphere(B);const G=g?S/2:y?-S/2:0,Z=h?-Y/2:f?Y/2:0,P=M?I/2:T?-I/2:0;ce.current.position.set(i||s?0:-L.x+Z,i||u?0:-L.y+G,i||d?0:-L.z+P),typeof b<"u"&&b({parent:O.current.parent,container:O.current,width:Y,height:S,depth:I,boundingBox:j,boundingSphere:B,center:L,verticalAlignment:G,horizontalAlignment:Z,depthAlignment:P})},[W,b,g,h,M,i,s,u,d,F,f,y,T]),z.useImperativeHandle(k,()=>O.current,[]),z.createElement("group",$r({ref:O},J),z.createElement("group",{ref:ce},z.createElement("group",{ref:re},t)))}),Bn=3e3,Nn=3001,it=(a,t,i)=>{let s;switch(a){case mr:s=new Uint8ClampedArray(t*i*4);break;case Me:s=new Uint16Array(t*i*4);break;case en:s=new Uint32Array(t*i*4);break;case Qt:s=new Int8Array(t*i*4);break;case Jt:s=new Int16Array(t*i*4);break;case Kt:s=new Int32Array(t*i*4);break;case Oe:s=new Float32Array(t*i*4);break;default:throw new Error("Unsupported data type")}return s};let lr;const kn=(a,t,i,s)=>{if(lr!==void 0)return lr;const u=new qr(1,1,s);t.setRenderTarget(u);const d=new Sr(new Vr,new wr({color:16777215}));t.render(d,i),t.setRenderTarget(null);const h=it(a,u.width,u.height);return t.readRenderTargetPixels(u,0,0,u.width,u.height,h),u.dispose(),d.geometry.dispose(),d.material.dispose(),lr=h[0]!==0,lr};class Ir{constructor(t){var i,s,u,d,h,f,g,y,M,T,b,F,W,J,k,O;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(re){throw this._renderer.setRenderTarget(null),re}this._renderer.setRenderTarget(null)},this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const ce={format:rr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((i=t.renderTargetOptions)===null||i===void 0?void 0:i.anisotropy)!==void 0?(s=t.renderTargetOptions)===null||s===void 0?void 0:s.anisotropy:1,generateMipmaps:((u=t.renderTargetOptions)===null||u===void 0?void 0:u.generateMipmaps)!==void 0?(d=t.renderTargetOptions)===null||d===void 0?void 0:d.generateMipmaps:!1,magFilter:((h=t.renderTargetOptions)===null||h===void 0?void 0:h.magFilter)!==void 0?(f=t.renderTargetOptions)===null||f===void 0?void 0:f.magFilter:Re,minFilter:((g=t.renderTargetOptions)===null||g===void 0?void 0:g.minFilter)!==void 0?(y=t.renderTargetOptions)===null||y===void 0?void 0:y.minFilter:Re,samples:((M=t.renderTargetOptions)===null||M===void 0?void 0:M.samples)!==void 0?(T=t.renderTargetOptions)===null||T===void 0?void 0:T.samples:void 0,wrapS:((b=t.renderTargetOptions)===null||b===void 0?void 0:b.wrapS)!==void 0?(F=t.renderTargetOptions)===null||F===void 0?void 0:F.wrapS:ke,wrapT:((W=t.renderTargetOptions)===null||W===void 0?void 0:W.wrapT)!==void 0?(J=t.renderTargetOptions)===null||J===void 0?void 0:J.wrapT:ke};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=Ir.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Yr,this._camera=new Yt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!kn(this._type,this._renderer,this._camera,ce)){let re;switch(this._type){case Me:re=this._renderer.extensions.has("EXT_color_buffer_float")?Oe:void 0;break}re!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Oe}`),this._type=re):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Sr(new Vr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new qr(this.width,this.height,ce),this._renderTarget.texture.mapping=((k=t.renderTargetOptions)===null||k===void 0?void 0:k.mapping)!==void 0?(O=t.renderTargetOptions)===null||O===void 0?void 0:O.mapping:ur}static instantiateRenderer(){const t=new Vt;return t.setSize(128,128),t}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=it(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const i=new qt(this.toArray(),this.width,this.height,rr,this._type,(t==null?void 0:t.mapping)||ur,(t==null?void 0:t.wrapS)||ke,(t==null?void 0:t.wrapT)||ke,(t==null?void 0:t.magFilter)||Re,(t==null?void 0:t.minFilter)||Re,(t==null?void 0:t.anisotropy)||1,fr);return i.generateMipmaps=(t==null?void 0:t.generateMipmaps)!==void 0?t==null?void 0:t.generateMipmaps:!1,i}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof Mr&&Object.values(this.material.uniforms).forEach(i=>{i.value instanceof ze&&i.value.dispose()}),Object.values(this.material).forEach(i=>{i instanceof ze&&i.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const Ln=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Pn=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Hn extends Mr{constructor({gamma:t,offsetHdr:i,offsetSdr:s,gainMapMin:u,gainMapMax:d,maxDisplayBoost:h,hdrCapacityMin:f,hdrCapacityMax:g,sdr:y,gainMap:M}){super({name:"GainMapDecoderMaterial",vertexShader:Ln,fragmentShader:Pn,uniforms:{sdr:{value:y},gainMap:{value:M},gamma:{value:new Ze(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new Ze().fromArray(i)},offsetSdr:{value:new Ze().fromArray(s)},gainMapMin:{value:new Ze().fromArray(u)},gainMapMax:{value:new Ze().fromArray(d)},weightFactor:{value:(Math.log2(h)-f)/(g-f)}},blending:an,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=h,this._hdrCapacityMin=f,this._hdrCapacityMax=g,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const i=this.uniforms.gamma.value;i.x=1/t[0],i.y=1/t[1],i.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class ot extends Error{}class st extends Error{}const Qe=(a,t,i)=>{var s;let u;const d=(s=a.attributes.getNamedItem(t))===null||s===void 0?void 0:s.nodeValue;if(d)u=d;else{const h=a.getElementsByTagName(t)[0];if(h){const f=h.getElementsByTagName("rdf:li");if(f.length===3)u=Array.from(f).map(g=>g.innerHTML);else throw new Error(`Gainmap metadata contains an array of items for ${t} but its length is not 3`)}else{if(i)return i;throw new Error(`Can't find ${t} in gainmap metadata`)}}return u},zn=a=>{var t,i;let s;typeof TextDecoder<"u"?s=new TextDecoder().decode(a):s=a.toString();let u=s.indexOf("<x:xmpmeta");const d=new DOMParser;for(;u!==-1;){const h=s.indexOf("x:xmpmeta>",u);s.slice(u,h+10);const f=s.slice(u,h+10);try{const y=d.parseFromString(f,"text/xml").getElementsByTagName("rdf:Description")[0],M=Qe(y,"hdrgm:GainMapMin","0"),T=Qe(y,"hdrgm:GainMapMax"),b=Qe(y,"hdrgm:Gamma","1"),F=Qe(y,"hdrgm:OffsetSDR","0.015625"),W=Qe(y,"hdrgm:OffsetHDR","0.015625");let J=(t=y.attributes.getNamedItem("hdrgm:HDRCapacityMin"))===null||t===void 0?void 0:t.nodeValue;J||(J="0");const k=(i=y.attributes.getNamedItem("hdrgm:HDRCapacityMax"))===null||i===void 0?void 0:i.nodeValue;if(!k)throw new Error("Incomplete gainmap metadata");return{gainMapMin:Array.isArray(M)?M.map(O=>parseFloat(O)):[parseFloat(M),parseFloat(M),parseFloat(M)],gainMapMax:Array.isArray(T)?T.map(O=>parseFloat(O)):[parseFloat(T),parseFloat(T),parseFloat(T)],gamma:Array.isArray(b)?b.map(O=>parseFloat(O)):[parseFloat(b),parseFloat(b),parseFloat(b)],offsetSdr:Array.isArray(F)?F.map(O=>parseFloat(O)):[parseFloat(F),parseFloat(F),parseFloat(F)],offsetHdr:Array.isArray(W)?W.map(O=>parseFloat(O)):[parseFloat(W),parseFloat(W),parseFloat(W)],hdrCapacityMin:parseFloat(J),hdrCapacityMax:parseFloat(k)}}catch{}u=s.indexOf("<x:xmpmeta",h)}};class Gn{constructor(t){this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((i,s)=>{const u=this.options.debug,d=new DataView(t.buffer);if(d.getUint16(0)!==65496){s(new Error("Not a valid jpeg"));return}const h=d.byteLength;let f=2,g=0,y;for(;f<h;){if(++g>250){s(new Error(`Found no marker after ${g} loops 😵`));return}if(d.getUint8(f)!==255){s(new Error(`Not a valid marker at offset 0x${f.toString(16)}, found: 0x${d.getUint8(f).toString(16)}`));return}if(y=d.getUint8(f+1),u&&console.log(`Marker: ${y.toString(16)}`),y===226){u&&console.log("Found APP2 marker (0xffe2)");const M=f+4;if(d.getUint32(M)===1297106432){const T=M+4;let b;if(d.getUint16(T)===18761)b=!1;else if(d.getUint16(T)===19789)b=!0;else{s(new Error("No valid endianness marker found in TIFF header"));return}if(d.getUint16(T+2,!b)!==42){s(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const F=d.getUint32(T+4,!b);if(F<8){s(new Error("Not valid TIFF data! (First offset less than 8)"));return}const W=T+F,J=d.getUint16(W,!b),k=W+2;let O=0;for(let L=k;L<k+12*J;L+=12)d.getUint16(L,!b)===45057&&(O=d.getUint32(L+8,!b));const re=W+2+J*12+4,j=[];for(let L=re;L<re+O*16;L+=16){const B={MPType:d.getUint32(L,!b),size:d.getUint32(L+4,!b),dataOffset:d.getUint32(L+8,!b),dependantImages:d.getUint32(L+12,!b),start:-1,end:-1,isFII:!1};B.dataOffset?(B.start=T+B.dataOffset,B.isFII=!1):(B.start=0,B.isFII=!0),B.end=B.start+B.size,j.push(B)}if(this.options.extractNonFII&&j.length){const L=new Blob([d]),B=[];for(const Y of j){if(Y.isFII&&!this.options.extractFII)continue;const S=L.slice(Y.start,Y.end+1,"image/jpeg");B.push(S)}i(B)}}}f+=2+d.getUint16(f+2)}})}}const Zn=async a=>{const t=zn(a);if(!t)throw new st("Gain map XMP metadata not found");const s=await new Gn({extractFII:!0,extractNonFII:!0}).extract(a);if(s.length!==2)throw new ot("Gain map recovery image not found");return{sdr:new Uint8Array(await s[0].arrayBuffer()),gainMap:new Uint8Array(await s[1].arrayBuffer()),metadata:t}},Gr=a=>new Promise((t,i)=>{const s=document.createElement("img");s.onload=()=>{t(s)},s.onerror=u=>{i(u)},s.src=URL.createObjectURL(a)});class lt extends rn{constructor(t,i){super(i),t&&(this._renderer=t),this._internalLoadingManager=new tn}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=new Hn({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new ze,sdr:new ze});return new Ir({width:16,height:16,type:Me,colorSpace:fr,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(t,i,s,u){const d=u?new Blob([u],{type:"image/jpeg"}):void 0,h=new Blob([s],{type:"image/jpeg"});let f,g,y=!1;if(typeof createImageBitmap>"u"){const b=await Promise.all([d?Gr(d):Promise.resolve(void 0),Gr(h)]);g=b[0],f=b[1],y=!0}else{const b=await Promise.all([d?createImageBitmap(d,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(h,{imageOrientation:"flipY"})]);g=b[0],f=b[1]}const M=new ze(g||new ImageData(2,2),ur,ke,ke,Re,Pr,rr,mr,1,fr);M.flipY=y,M.needsUpdate=!0;const T=new ze(f,ur,ke,ke,Re,Pr,rr,mr,1,nn);T.flipY=y,T.needsUpdate=!0,t.width=f.width,t.height=f.height,t.material.gainMap=M,t.material.sdr=T,t.material.gainMapMin=i.gainMapMin,t.material.gainMapMax=i.gainMapMax,t.material.offsetHdr=i.offsetHdr,t.material.offsetSdr=i.offsetSdr,t.material.gamma=i.gamma,t.material.hdrCapacityMin=i.hdrCapacityMin,t.material.hdrCapacityMax=i.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,i.hdrCapacityMax),t.material.needsUpdate=!0,t.render()}}class Wn extends lt{load([t,i,s],u,d,h){const f=this.prepareQuadRenderer();let g,y,M;const T=async()=>{if(g&&y&&M){try{await this.render(f,M,g,y)}catch(I){this.manager.itemError(t),this.manager.itemError(i),this.manager.itemError(s),typeof h=="function"&&h(I),f.disposeOnDemandRenderer();return}typeof u=="function"&&u(f),this.manager.itemEnd(t),this.manager.itemEnd(i),this.manager.itemEnd(s),f.disposeOnDemandRenderer()}};let b=!0,F=0,W=0,J=!0,k=0,O=0,ce=!0,re=0,j=0;const L=()=>{if(typeof d=="function"){const I=F+k+re,G=W+O+j,Z=b&&J&&ce;d(new ProgressEvent("progress",{lengthComputable:Z,loaded:G,total:I}))}};this.manager.itemStart(t),this.manager.itemStart(i),this.manager.itemStart(s);const B=new cr(this._internalLoadingManager);B.setResponseType("arraybuffer"),B.setRequestHeader(this.requestHeader),B.setPath(this.path),B.setWithCredentials(this.withCredentials),B.load(t,async I=>{if(typeof I=="string")throw new Error("Invalid sdr buffer");g=I,await T()},I=>{b=I.lengthComputable,W=I.loaded,F=I.total,L()},I=>{this.manager.itemError(t),typeof h=="function"&&h(I)});const Y=new cr(this._internalLoadingManager);Y.setResponseType("arraybuffer"),Y.setRequestHeader(this.requestHeader),Y.setPath(this.path),Y.setWithCredentials(this.withCredentials),Y.load(i,async I=>{if(typeof I=="string")throw new Error("Invalid gainmap buffer");y=I,await T()},I=>{J=I.lengthComputable,O=I.loaded,k=I.total,L()},I=>{this.manager.itemError(i),typeof h=="function"&&h(I)});const S=new cr(this._internalLoadingManager);return S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(s,async I=>{if(typeof I!="string")throw new Error("Invalid metadata string");M=JSON.parse(I),await T()},I=>{ce=I.lengthComputable,j=I.loaded,re=I.total,L()},I=>{this.manager.itemError(s),typeof h=="function"&&h(I)}),f}}class Xn extends lt{load(t,i,s,u){const d=this.prepareQuadRenderer(),h=new cr(this._internalLoadingManager);return h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setPath(this.path),h.setWithCredentials(this.withCredentials),this.manager.itemStart(t),h.load(t,async f=>{if(typeof f=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const g=new Uint8Array(f);let y,M,T;try{const b=await Zn(g);y=b.sdr,M=b.gainMap,T=b.metadata}catch(b){if(b instanceof st||b instanceof ot)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),T={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},y=g;else throw b}try{await this.render(d,T,y,M)}catch(b){this.manager.itemError(t),typeof u=="function"&&u(b),d.disposeOnDemandRenderer();return}typeof i=="function"&&i(d),this.manager.itemEnd(t),d.disposeOnDemandRenderer()},s,f=>{this.manager.itemError(t),typeof u=="function"&&u(f)}),d}}const nr={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},ct="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Xe=a=>Array.isArray(a),xr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function dr({files:a=xr,path:t="",preset:i=void 0,encoding:s=void 0,extensions:u}={}){let d=null,h=!1;i&&(br(i),a=nr[i],t=ct),h=Xe(a);const{extension:f,isCubemap:g}=Tr(a);if(d=Cr(f),!d)throw new Error("useEnvironment: Unrecognized file extension: "+a);const y=tr(F=>F.gl);z.useLayoutEffect(()=>{if(f!=="webp"&&f!=="jpg"&&f!=="jpeg")return;function F(){hr.clear(d,h?[a]:a)}y.domElement.addEventListener("webglcontextlost",F,{once:!0})},[a,y.domElement]);const M=hr(d,h?[a]:a,F=>{(f==="webp"||f==="jpg"||f==="jpeg")&&F.setRenderer(y),F.setPath==null||F.setPath(t),u&&u(F)});let T=h?M[0]:M;if(f==="jpg"||f==="jpeg"||f==="webp"){var b;T=(b=T.renderTarget)==null?void 0:b.texture}return T.mapping=g?on:sn,"colorSpace"in T?T.colorSpace=s??g?"srgb":"srgb-linear":T.encoding=s??g?Nn:Bn,T}const jn={files:xr,path:"",preset:void 0,extensions:void 0};dr.preload=a=>{const t={...jn,...a};let{files:i,path:s=""}=t;const{preset:u,extensions:d}=t;u&&(br(u),i=nr[u],s=ct);const{extension:h}=Tr(i);if(h==="webp"||h==="jpg"||h==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const f=Cr(h);if(!f)throw new Error("useEnvironment: Unrecognized file extension: "+i);hr.preload(f,Xe(i)?[i]:i,g=>{g.setPath==null||g.setPath(s),d&&d(g)})};const $n={files:xr,preset:void 0};dr.clear=a=>{const t={...$n,...a};let{files:i}=t;const{preset:s}=t;s&&(br(s),i=nr[s]);const{extension:u}=Tr(i),d=Cr(u);if(!d)throw new Error("useEnvironment: Unrecognized file extension: "+i);hr.clear(d,Xe(i)?[i]:i)};function br(a){if(!(a in nr))throw new Error("Preset must be one of: "+Object.keys(nr).join(", "))}function Tr(a){var t;const i=Xe(a)&&a.length===6,s=Xe(a)&&a.length===3&&a.some(h=>h.endsWith("json")),u=Xe(a)?a[0]:a;return{extension:i?"cube":s?"webp":u.startsWith("data:application/exr")?"exr":u.startsWith("data:application/hdr")?"hdr":u.startsWith("data:image/jpeg")?"jpg":(t=u.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:i,isGainmap:s}}function Cr(a){return a==="cube"?ln:a==="hdr"?Un:a==="exr"?On:a==="jpg"||a==="jpeg"?Xn:a==="webp"?Wn:null}const Yn=a=>a.current&&a.current.isScene,Vn=a=>Yn(a)?a.current:a;function Rr(a,t,i,s,u={}){var d,h,f,g,y;u={backgroundBlurriness:(d=u.blur)!==null&&d!==void 0?d:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...u};const M=Vn(t||i),T=M.background,b=M.environment,F={backgroundBlurriness:M.backgroundBlurriness,backgroundIntensity:M.backgroundIntensity,backgroundRotation:(h=(f=M.backgroundRotation)==null||f.clone==null?void 0:f.clone())!==null&&h!==void 0?h:[0,0,0],environmentIntensity:M.environmentIntensity,environmentRotation:(g=(y=M.environmentRotation)==null||y.clone==null?void 0:y.clone())!==null&&g!==void 0?g:[0,0,0]};return a!=="only"&&(M.environment=s),a&&(M.background=s),Hr(M,u),()=>{a!=="only"&&(M.environment=b),a&&(M.background=T),Hr(M,F)}}function Ar({scene:a,background:t=!1,map:i,...s}){const u=tr(d=>d.scene);return z.useLayoutEffect(()=>{if(i)return Rr(t,a,u,i,s)}),null}function ut({background:a=!1,scene:t,blur:i,backgroundBlurriness:s,backgroundIntensity:u,backgroundRotation:d,environmentIntensity:h,environmentRotation:f,...g}){const y=dr(g),M=tr(T=>T.scene);return z.useLayoutEffect(()=>Rr(a,t,M,y,{blur:i,backgroundBlurriness:s,backgroundIntensity:u,backgroundRotation:d,environmentIntensity:h,environmentRotation:f})),null}function qn({children:a,near:t=1,far:i=1e3,resolution:s=256,frames:u=1,map:d,background:h=!1,blur:f,backgroundBlurriness:g,backgroundIntensity:y,backgroundRotation:M,environmentIntensity:T,environmentRotation:b,scene:F,files:W,path:J,preset:k=void 0,extensions:O}){const ce=tr(S=>S.gl),re=tr(S=>S.scene),j=z.useRef(null),[L]=z.useState(()=>new Yr),B=z.useMemo(()=>{const S=new cn(s);return S.texture.type=Me,S},[s]);z.useLayoutEffect(()=>(u===1&&j.current.update(ce,L),Rr(h,F,re,B.texture,{blur:f,backgroundBlurriness:g,backgroundIntensity:y,backgroundRotation:M,environmentIntensity:T,environmentRotation:b})),[a,L,B.texture,F,re,h,u,ce]);let Y=1;return Kr(()=>{(u===1/0||Y<u)&&(j.current.update(ce,L),Y++)}),z.createElement(z.Fragment,null,un(z.createElement(z.Fragment,null,a,z.createElement("cubeCamera",{ref:j,args:[t,i,B]}),W||k?z.createElement(ut,{background:!0,files:W,preset:k,path:J,extensions:O}):d?z.createElement(Ar,{background:!0,map:d,extensions:O}):null),L))}function Kn(a){var t,i,s,u;const d=dr(a),h=a.map||d;z.useMemo(()=>hn({GroundProjectedEnvImpl:Fn}),[]);const f=z.useMemo(()=>[h],[h]),g=(t=a.ground)==null?void 0:t.height,y=(i=a.ground)==null?void 0:i.radius,M=(s=(u=a.ground)==null?void 0:u.scale)!==null&&s!==void 0?s:1e3;return z.createElement(z.Fragment,null,z.createElement(Ar,$r({},a,{map:h})),z.createElement("groundProjectedEnvImpl",{args:f,scale:M,height:g,radius:y}))}function Jn(a){return a.ground?z.createElement(Kn,a):a.map?z.createElement(Ar,a):a.children?z.createElement(qn,a):z.createElement(ut,a)}const Qn=({value:a=5,text:t="未设置",axisX:i=0})=>{z.useEffect(()=>{},[]);const s={width:3,z:3,img:{height:2}};return Kr(()=>{}),de.jsxs("mesh",{position:[i,0,0],children:[de.jsxs(Dn,{top:!0,children:[de.jsx(pn,{args:[s.width,a,s.z],material:new wr({color:new Jr(16777215),map:new zr().load(_r+"/pano/bar.jpg")})}),de.jsx("meshNormalMaterial",{})]}),de.jsx(fn,{anchorY:"top",fontSize:1,scale:.5,maxWidth:3,color:"blue",position:[0,a-s.img.height,s.z/2+.1],children:t}),de.jsx(gn,{args:[s.width,s.img.height],position:[0,a-s.img.height/2,s.z/2+.1],material:new wr({map:new zr().load(_r+"/diff/us.jpeg"),side:Xr})})]})};function ea(){const a=[{value:5,text:"未设置"},{value:10,text:"已设置"},{value:15,text:"已设置"}];return de.jsx(de.Fragment,{children:a.map((t,i)=>z.createElement(Qn,{...t,key:i,axisX:i*5}))})}const ra=()=>de.jsx("div",{style:{height:"60vh"},children:de.jsxs(dn,{dpr:[1,2],scene:{background:new Jr(16777215),castShadow:!0},gl:{alpha:!1},camera:{position:[0,0,20],fov:70},children:[de.jsx(Jn,{background:!0,files:_r+"/pano/jizhuangxhdr.jpg"}),de.jsx(vn,{}),de.jsx("axesHelper",{args:[10]}),de.jsx("ambientLight",{intensity:Math.PI}),de.jsx(ea,{})]})}),ta=`import {
  Box,
  Center,
  Environment,
  OrbitControls,
  Plane,
  Text,
} from '@react-three/drei'
import { Canvas, useFrame } from '@react-three/fiber'
import React, { useEffect } from 'react'
import * as THREE from 'three'
import { staticPath } from '../../../utils'

const Bar = ({ value = 5, text = '未设置', axisX = 0 }) => {
  useEffect(() => {}, [])
  const bar = {
    width: 3,
    z: 3,
    img: {
      height: 2,
    },
  }
  useFrame(() => {
    // console.log(pivotControl.current.rotation)
    // text.current.rotation.z += 0.01
  })

  return (
    <mesh position={[axisX, 0, 0]}>
      <Center top>
        <Box
          args={[bar.width, value, bar.z]}
          material={
            new THREE.MeshBasicMaterial({
              color: new THREE.Color(0xffffff),
              map: new THREE.TextureLoader().load(staticPath + '/pano/bar.jpg'),
            })
          }
        />
        <meshNormalMaterial />
      </Center>
      <Text
        anchorY={'top'}
        fontSize={1}
        scale={0.5}
        maxWidth={3}
        color={'blue'}
        position={[0, value - bar.img.height, bar.z / 2 + 0.1]}
      >
        {text}
      </Text>
      <Plane
        args={[bar.width, bar.img.height]}
        position={[0, value - bar.img.height / 2, bar.z / 2 + 0.1]}
        material={
          new THREE.MeshBasicMaterial({
            map: new THREE.TextureLoader().load(staticPath + '/diff/us.jpeg'),
            side: THREE.DoubleSide,
          })
        }
      ></Plane>
    </mesh>
  )
}

function Com() {
  const data = [
    { value: 5, text: '未设置' },
    { value: 10, text: '已设置' },
    { value: 15, text: '已设置' },
  ]
  return (
    <>
      {data.map((item, index) => (
        <Bar {...item} key={index} axisX={index * 5} />
      ))}
    </>
  )
}
const DataDiff = () => {
  return (
    <div style={{ height: '60vh' }}>
      <Canvas
        dpr={[1, 2]}
        scene={{ background: new THREE.Color(0xffffff), castShadow: true }}
        gl={{ alpha: false }}
        camera={{ position: [0, 0, 20], fov: 70 }}
      >
        <Environment
          background={true}
          files={staticPath + '/pano/jizhuangxhdr.jpg'}
        />
        <OrbitControls />
        <axesHelper args={[10]} />
        <ambientLight intensity={Math.PI} />
        <Com />
      </Canvas>
    </div>
  )
}

export default DataDiff
`,na=void 0,aa=void 0,ia={code:ta,title:na,desc:aa},oa=!0,sa=Object.freeze(Object.defineProperty({__proto__:null,default:ra,demoMeta:ia,isDemo:oa},Symbol.toStringTag,{value:"Module"}));function Zr(a){const{Demo:t}={...Wr(),...a.components};return t||ca("Demo"),de.jsx(t,{...sa})}function la(a={}){const{wrapper:t}={...Wr(),...a.components};return t?de.jsx(t,{...a,children:de.jsx(Zr,{...a})}):Zr(a)}function ca(a,t){throw new Error("Expected component `"+a+"` to be defined: you likely forgot to import, pass, or provide it.")}const ua=Object.freeze(Object.defineProperty({__proto__:null,default:la},Symbol.toStringTag,{value:"Module"})),ht={};ht.outlineInfo=Gt;ht.main=ua;export{ht as default};
